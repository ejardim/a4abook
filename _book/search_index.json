[["annex---stock-assessment-workflow.html", "18 Annex - stock assessment workflow 18.1 The “mean” model 18.2 The age effects 18.3 Year effect on fishing mortality 18.4 Year effect on catchability 18.5 The initial year population abundance model, aka N1 18.6 The stock recruitment submodel 18.7 The variance submodel 18.8 Final comments", " 18 Annex - stock assessment workflow The following sections describes a potential workflow for fitting a a4a stock assessment model. The idea is to explore the age and year effects in isolation and adjust the model’s smoothness to model those effects. The procedure is heavily supported by residuals’ analysis. In a well specified model residuals should show a random pattern, without any trend or very high values (outliers). 18.1 The “mean” model To start the analysis we’ll fit a “mean” model, where all submodels will be set to an overall average, by using the \\(\\sim 1\\) formula. This will be our reference model to see how adding age and year effects will show up in the diagnostic tools, in particular in the residuals. library(FLa4a) data(hke1567) data(hke1567.idx) fit01 &lt;- sca(hke1567, hke1567.idx, fmod=~1, qmod=list(~1), srmod=~1, vmod=list(~1, ~1), n1mod=~1) res01 &lt;- residuals(fit01, hke1567, hke1567.idx) The common residuals plot clearly shows a time trend for each age (Figure 18.2) for both datasets. Furthermore, inspecting how catch ate age residuals are positioned across ages, by comparing the level of residuals for each age, one can see the pattern of lower than 0 residuals in age 0, reversing the signal for ages 1 and 2, close to 0 in ages 3 and 4, and again below 0 in age 5. plot(res01) Figure 18.1: Mean fit residuals by year) This pattern becomes more apparent when plotting the residuals by age across years. plot(res01, auxline=&quot;l&quot;, by=&quot;age&quot;) Figure 18.2: Mean fit residuals by age 18.2 The age effects The following models will introduce age effects in the fishing mortality submodel and catchability submodel. In the fishing mortality submodel we’ll introduce a factor which means that there will be as many parameters as ages minus 1 and each parameters will be independent of each other. fit02 &lt;- sca(hke1567, hke1567.idx, fmod=~factor(age), qmod=list(~1), srmod=~1, vmod=list(~1, ~1), n1mod=~1) res02 &lt;- residuals(fit02, hke1567, hke1567.idx) The residuals plot now shows catch at age residuals less stagered, reflecting the modelling of the age effect. plot(res02) Figure 18.3: Fishing mortality model with age effect residuals by year The residuals plot by age shows the same outcome. plot(res02, auxline=&quot;l&quot;, by=&quot;age&quot;) Figure 18.4: Fishing mortality model with age effect residuals by age We’ll now proceed adding an age effect to the catchability model while removing the catch at age effect. fit03 &lt;- sca(hke1567, hke1567.idx, fmod=~1, qmod=list(~factor(age)), srmod=~1, vmod=list(~1, ~1), n1mod=~1) res03 &lt;- residuals(fit03, hke1567, hke1567.idx) plot(res03) Figure 18.5: Index catchability model with age effect residuals by year The residuals plot by age shows the same outcome. plot(res03, auxline=&quot;l&quot;, by=&quot;age&quot;) Figure 18.6: Index catchability model with age effect residuals by age Finally both effects are brought together. fit04 &lt;- sca(hke1567, hke1567.idx, fmod=~factor(age), qmod=list(~factor(age)), srmod=~1, vmod=list(~1, ~1), n1mod=~1) res04 &lt;- residuals(fit04, hke1567, hke1567.idx) plot(res04) Figure 18.7: Fishing mortality and index catchability models with age effect residuals by year The residuals plot by age shows the same outcome. plot(res04, auxline=&quot;l&quot;, by=&quot;age&quot;) Figure 18.8: Fishing mortality and index catchability models with age effect residuals by age 18.3 Year effect on fishing mortality This model will introduce an year effect in the fishing mortality submodel on top of the F age effect added before. Inspecting the last set of residuals (Figure 18.8) one can easily see the pattern across years with more positive residuals in the beggining of the time series and more negative in the most recent years. As for age we’re using a factor for years. The new model’s residuals won’t show such a pronounced effect anymore (Figures 18.9 and 18.10). fit05 &lt;- sca(hke1567, hke1567.idx, fmod=~factor(age) + factor(year), qmod=list(~1), srmod=~1, vmod=list(~1, ~1), n1mod=~1) res05 &lt;- residuals(fit05, hke1567, hke1567.idx) plot(res05) Figure 18.9: Fishing mortality model with year effect residuals by year The residuals plot by age shows the same outcome. plot(res05, auxline=&quot;l&quot;, by=&quot;age&quot;) Figure 18.10: Fishing mortality model with year effect residuals by age We can see now that the residuals show a lot less patterns than before. There’s still some issues, the survey catchability seems to have an year trend. However the model is not fully specified yet, stock recruitment is modelled as constant over time, the initial population abundance is also modelled as a constant as well as the variance models. 18.4 Year effect on catchability It’s uncommon to include year trends on the abundance index catchability model. Such decision needs to be considered carefully as the trend in the index, in the case of a well design scientific survey, should result from a change in abundance. Modelling that trend would attribute such change to the survey design and remove it from the abundance. If the survey index is based on a commercial CPUE it becomes more likely that changes in selectivity or fishing behaviour could show up in the index as changes in abundance. Although the common process of standardizing CPUEs should deal with technical issues. In the case of adding year effects to teh catchability submode the same formulas can be used, to include period breaks, trends, etc. 18.5 The initial year population abundance model, aka N1 This model sets the n-at-age in the first year of the time series, which is needed due to the lack of previous data to reconstruct those cohorts. It will affect the population numbers in the lower triangle of the initial population matrix and catches. The following model will introduce an age effect in the population abundance in the first year of the time series. fit06 &lt;- sca(hke1567, hke1567.idx, fmod=~factor(age) + factor(year), qmod=list(~factor(age)), srmod=~1, vmod=list(~1, ~1), n1mod=~factor(age)) res06 &lt;- residuals(fit06, hke1567, hke1567.idx) The best way to inspect the effect of this model is to zoom into the initial years of the time series. Figure 18.11 zooms into the previous model, which used an intercept only model for N1, while Figure 18.12. Figure 18.11: N1 fitted as an intercept only model: 2007 - 2010 residuals by age Figure 18.12: N1 fitted with an age effect model: 2007 - 2010 residuals by age Comparing the two plots it can be seen the effect of modeling abundance in the initial year. Residuals for both catch at age and catchability improved considerably. The following years also improve to different levels. 18.6 The stock recruitment submodel In this example we’ll simply add a model to allow recruitment to vary over time and we’ll see how to track potential improvements in the residuals. fit07 &lt;- sca(hke1567, hke1567.idx, fmod=~factor(age) + factor(year), qmod=list(~factor(age)), srmod=~factor(year), vmod=list(~1, ~1), n1mod=~factor(age)) res07 &lt;- residuals(fit07, hke1567, hke1567.idx) The residuals plot by year are very useful to see the effect of adding a varying stock recruitment model. The year trends present in previous models are not absent. Recruitment variability when left unmodelled was being picked up by trends in the survey catchability and catch at age. And due to the cohort dynamics underlying the catch at age model, where propagating into other ages’ estimates. plot(res07) Figure 18.13: Stock-recruitment model with year effect residuals by year 18.7 The variance submodel Finally, we’re testing the variance submodel, specifically the catch at age variance model. We won’t dig into the catchability variance model though. It’s common to accept that a scientific survey following a well designed sampling protocol will have equal variance across ages since no preferential areas should be sampled sampled. The variance model will use a smoother with k=3. The expectation is that the variance model will have a U-shape, since yourger and older ages are usually less caught and as such estomates of those ages will have larger variances than fully exploited ages. fit08 &lt;- sca(hke1567, hke1567.idx, fmod=~factor(age) + s(year, k=10), qmod=list(~factor(age)), srmod=~s(year, k=10), vmod=list(~s(age, k=3), ~1), n1mod=~factor(age)) We’ll use the pearson residuals for this analysis since those are standardized by the predicted variances of the model and not the residual variance itself, like the more common standardized residuals. Figure 18.15 shows an improve set of residuals when compared to Figure 18.14 which add an intercept only model for the variance model. res07 &lt;- residuals(fit07, hke1567, hke1567.idx, type=&quot;pearson&quot;) res08 &lt;- residuals(fit08, hke1567, hke1567.idx, type=&quot;pearson&quot;) plot(res07) Figure 18.14: Variance model with intercept only age effect pearson residuals plot(res08) Figure 18.15: Variance model with age effect pearson residuals To see what’s happening with the variance model one can use predict to plot the different models fitted. flqs &lt;- FLQuants(mod08=predict(fit08)$vmodel$catch[,&quot;2022&quot;], mod07=predict(fit07)$vmodel$catch[,&quot;2022&quot;]) xyplot(data~age, data=flqs, group=qname, type=&quot;l&quot;, auto.key=T) Figure 18.16: Variance models for catch at age To see the effect these models have on the estimated quantities one can look at the variance of the estimates: flqs &lt;- FLQuants(mod08=catch.n(hke1567+simulate(fit08, nsim=500))[,&quot;2022&quot;], mod07=catch.n(hke1567+simulate(fit07, nsim=500))[,&quot;2022&quot;]) bwplot(data~qname|factor(age), data=as.data.frame(flqs), scales=&quot;free&quot;, auto.key=T) Figure 18.17: Estimates of population abundance with different variance models 18.8 Final comments The sequence presented here can be changed and eploited in any order the user is interested or prefers to. The approach of not allowing year effects in surveys and variance model can be modified if the user prefers to do so. The (ab)use of factor is for demonstration purposes only. The user is incentivised to explore other model forms, in particular smoothers. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
