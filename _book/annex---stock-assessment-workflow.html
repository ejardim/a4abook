<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>18 Annex - stock assessment workflow | Fish stock assessment with R</title>
  <meta name="description" content="How to do stock assessment in R using the a4a framework" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="18 Annex - stock assessment workflow | Fish stock assessment with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="How to do stock assessment in R using the a4a framework" />
  <meta name="github-repo" content="ejardim/a4abook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="18 Annex - stock assessment workflow | Fish stock assessment with R" />
  
  <meta name="twitter:description" content="How to do stock assessment in R using the a4a framework" />
  

<meta name="author" content="John Doe and friends" />


<meta name="date" content="2025-02-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sections-to-be-added.html"/>

<script src="libs/jquery-3.6.1/jquery-3.6.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Stock assessment framework</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Before starting</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#license-documentation-and-development-status"><i class="fa fa-check"></i><b>1.1</b> License, documentation and development status</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installing-and-loading-libraries"><i class="fa fa-check"></i><b>1.2</b> Installing and loading libraries</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#how-to-read-this-document"><i class="fa fa-check"></i><b>1.3</b> How to read this document</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#how-to-get-help"><i class="fa fa-check"></i><b>1.4</b> How to get help</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#notation"><i class="fa fa-check"></i><b>1.5</b> Notation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#the-assessment-for-all-initiative-a4a"><i class="fa fa-check"></i><b>2.1</b> The “Assessment for All” Initiative (a4a)</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#multi-stage-modelling-approach"><i class="fa fa-check"></i><b>2.2</b> Multi-stage modelling approach</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#stock-assessment-process"><i class="fa fa-check"></i><b>2.3</b> Stock Assessment Process</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#stock-assessment-as-a-linear-model-colin"><i class="fa fa-check"></i><b>2.4</b> Stock assessment as a linear model [COLIN]</a></li>
<li class="chapter" data-level="2.5" data-path="introduction.html"><a href="introduction.html#data-used-in-the-book"><i class="fa fa-check"></i><b>2.5</b> Data used in the book</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="introduction.html"><a href="introduction.html#plaice-in-area-fao-27-ices-area-iv"><i class="fa fa-check"></i><b>2.5.1</b> Plaice in area FAO 27, ICES area IV</a></li>
<li class="chapter" data-level="2.5.2" data-path="introduction.html"><a href="introduction.html#european-hake-in-fao-37-gsas-1567"><i class="fa fa-check"></i><b>2.5.2</b> European hake in FAO 37, GSAs 1,5,6,7</a></li>
<li class="chapter" data-level="2.5.3" data-path="introduction.html"><a href="introduction.html#stock-xx"><i class="fa fa-check"></i><b>2.5.3</b> stock xx</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-splines.html"><a href="introduction-to-splines.html"><i class="fa fa-check"></i><b>3</b> Introduction to Splines</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-splines.html"><a href="introduction-to-splines.html#understanding-spline-basics"><i class="fa fa-check"></i><b>3.1</b> Understanding Spline Basics</a></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-splines.html"><a href="introduction-to-splines.html#generate-some-artificial-data"><i class="fa fa-check"></i><b>3.2</b> Generate some artificial data</a></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-splines.html"><a href="introduction-to-splines.html#cubic-regression-splines"><i class="fa fa-check"></i><b>3.3</b> Cubic Regression Splines</a></li>
<li class="chapter" data-level="3.4" data-path="introduction-to-splines.html"><a href="introduction-to-splines.html#thin-plate-spline"><i class="fa fa-check"></i><b>3.4</b> Thin plate spline</a></li>
<li class="chapter" data-level="3.5" data-path="introduction-to-splines.html"><a href="introduction-to-splines.html#comparison"><i class="fa fa-check"></i><b>3.5</b> Comparison</a></li>
<li class="chapter" data-level="3.6" data-path="introduction-to-splines.html"><a href="introduction-to-splines.html#the-mgcv-package-inside-a4a"><i class="fa fa-check"></i><b>3.6</b> The <code>mgcv</code> package inside <code>a4a</code></a></li>
<li class="chapter" data-level="3.7" data-path="introduction-to-splines.html"><a href="introduction-to-splines.html#on-the-number-of-knots-k"><i class="fa fa-check"></i><b>3.7</b> On the number of knots <span class="math inline">\(k\)</span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="modelling-individual-growth-and-using-stochastic-slicing-to-convert-length-based-data-into-age-based-data.html"><a href="modelling-individual-growth-and-using-stochastic-slicing-to-convert-length-based-data-into-age-based-data.html"><i class="fa fa-check"></i><b>4</b> Modelling Individual Growth and Using Stochastic Slicing to Convert Length-based Data Into Age-based Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="modelling-individual-growth-and-using-stochastic-slicing-to-convert-length-based-data-into-age-based-data.html"><a href="modelling-individual-growth-and-using-stochastic-slicing-to-convert-length-based-data-into-age-based-data.html#a4agr---the-growth-class"><i class="fa fa-check"></i><b>4.1</b> a4aGr - The growth class</a></li>
<li class="chapter" data-level="4.2" data-path="modelling-individual-growth-and-using-stochastic-slicing-to-convert-length-based-data-into-age-based-data.html"><a href="modelling-individual-growth-and-using-stochastic-slicing-to-convert-length-based-data-into-age-based-data.html#adding-uncertainty-to-growth-parameters-with-a-multivariate-normal-distribution"><i class="fa fa-check"></i><b>4.2</b> Adding uncertainty to growth parameters with a multivariate normal distribution}</a></li>
<li class="chapter" data-level="4.3" data-path="modelling-individual-growth-and-using-stochastic-slicing-to-convert-length-based-data-into-age-based-data.html"><a href="modelling-individual-growth-and-using-stochastic-slicing-to-convert-length-based-data-into-age-based-data.html#adding-uncertainty-to-growth-parameters-with-a-multivariate-triangle-distribution"><i class="fa fa-check"></i><b>4.3</b> Adding uncertainty to growth parameters with a multivariate triangle distribution}</a></li>
<li class="chapter" data-level="4.4" data-path="modelling-individual-growth-and-using-stochastic-slicing-to-convert-length-based-data-into-age-based-data.html"><a href="modelling-individual-growth-and-using-stochastic-slicing-to-convert-length-based-data-into-age-based-data.html#adding-uncertainty-to-growth-parameters-with-statistical-copulas"><i class="fa fa-check"></i><b>4.4</b> Adding uncertainty to growth parameters with statistical copulas}</a></li>
<li class="chapter" data-level="4.5" data-path="modelling-individual-growth-and-using-stochastic-slicing-to-convert-length-based-data-into-age-based-data.html"><a href="modelling-individual-growth-and-using-stochastic-slicing-to-convert-length-based-data-into-age-based-data.html#converting-from-length-to-age-based-data---the-l2a-method"><i class="fa fa-check"></i><b>4.5</b> Converting from length to age based data - the <code>l2a()</code> method}</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="modelling-natural-mortality.html"><a href="modelling-natural-mortality.html"><i class="fa fa-check"></i><b>5</b> Modelling Natural Mortality</a>
<ul>
<li class="chapter" data-level="5.1" data-path="modelling-natural-mortality.html"><a href="modelling-natural-mortality.html#a4am---the-m-class"><i class="fa fa-check"></i><b>5.1</b> <code>a4aM</code> - The M class</a></li>
<li class="chapter" data-level="5.2" data-path="modelling-natural-mortality.html"><a href="modelling-natural-mortality.html#adding-uncertainty-to-natural-mortality-parameters-with-a-multivariate-normal-distribution"><i class="fa fa-check"></i><b>5.2</b> Adding uncertainty to natural mortality parameters with a multivariate normal distribution</a></li>
<li class="chapter" data-level="5.3" data-path="modelling-natural-mortality.html"><a href="modelling-natural-mortality.html#adding-uncertainty-to-natural-mortality-parameters-with-statistical-copulas"><i class="fa fa-check"></i><b>5.3</b> Adding uncertainty to natural mortality parameters with statistical copulas</a></li>
<li class="chapter" data-level="5.4" data-path="modelling-natural-mortality.html"><a href="modelling-natural-mortality.html#computing-natural-mortality-time-series---the-m-method"><i class="fa fa-check"></i><b>5.4</b> Computing natural mortality time series - the “m” method</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="stock-assessment-framework.html"><a href="stock-assessment-framework.html"><i class="fa fa-check"></i><b>6</b> Stock assessment framework</a>
<ul>
<li class="chapter" data-level="6.1" data-path="stock-assessment-framework.html"><a href="stock-assessment-framework.html#maths-description"><i class="fa fa-check"></i><b>6.1</b> Maths description </a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="stock-assessment-framework.html"><a href="stock-assessment-framework.html#observations"><i class="fa fa-check"></i><b>6.1.1</b> Observations</a></li>
<li class="chapter" data-level="6.1.2" data-path="stock-assessment-framework.html"><a href="stock-assessment-framework.html#the-population-dynamics-model"><i class="fa fa-check"></i><b>6.1.2</b> The population dynamics model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="stock-assessment-framework.html"><a href="stock-assessment-framework.html#classes-description"><i class="fa fa-check"></i><b>6.2</b> Classes Description </a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="submodel-structure.html"><a href="submodel-structure.html"><i class="fa fa-check"></i><b>7</b> Submodel structure </a>
<ul>
<li class="chapter" data-level="7.1" data-path="submodel-structure.html"><a href="submodel-structure.html#submodel-building-blocks-and-fundamental-r-formulas"><i class="fa fa-check"></i><b>7.1</b> Submodel building blocks and fundamental <code>R</code> formulas</a></li>
<li class="chapter" data-level="7.2" data-path="submodel-structure.html"><a href="submodel-structure.html#the-major-effects-available-for-modelling"><i class="fa fa-check"></i><b>7.2</b> The major effects available for modelling</a></li>
<li class="chapter" data-level="7.3" data-path="submodel-structure.html"><a href="submodel-structure.html#the-submodel-class-and-methods"><i class="fa fa-check"></i><b>7.3</b> The submodel class and methods</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="fitting.html"><a href="fitting.html"><i class="fa fa-check"></i><b>8</b> Fitting</a>
<ul>
<li class="chapter" data-level="8.1" data-path="fitting.html"><a href="fitting.html#fishing-mortality-submodel-f_ay"><i class="fa fa-check"></i><b>8.1</b> Fishing mortality submodel (<span class="math inline">\(F_{ay}\)</span>)</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="fitting.html"><a href="fitting.html#separable-model"><i class="fa fa-check"></i><b>8.1.1</b> Separable model</a></li>
<li class="chapter" data-level="8.1.2" data-path="fitting.html"><a href="fitting.html#constant-selectivity-for-contiguous-ages-or-years"><i class="fa fa-check"></i><b>8.1.2</b> Constant selectivity for contiguous ages or years</a></li>
<li class="chapter" data-level="8.1.3" data-path="fitting.html"><a href="fitting.html#time-blocks-selectivity"><i class="fa fa-check"></i><b>8.1.3</b> Time blocks selectivity</a></li>
<li class="chapter" data-level="8.1.4" data-path="fitting.html"><a href="fitting.html#time-changing-selectivity"><i class="fa fa-check"></i><b>8.1.4</b> Time changing selectivity</a></li>
<li class="chapter" data-level="8.1.5" data-path="fitting.html"><a href="fitting.html#closed-form-selection-pattern"><i class="fa fa-check"></i><b>8.1.5</b> Closed form selection pattern</a></li>
<li class="chapter" data-level="8.1.6" data-path="fitting.html"><a href="fitting.html#more-models-to-be-moved-to-its-own-section"><i class="fa fa-check"></i><b>8.1.6</b> More models [TO BE MOVED TO ITS OWN SECTION?]</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="fitting.html"><a href="fitting.html#abundance-indices-catchability-submodel-q_ays"><i class="fa fa-check"></i><b>8.2</b> Abundance indices catchability submodel (<span class="math inline">\(Q_{ays}\)</span>)</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="fitting.html"><a href="fitting.html#catchability-submodel-for-age-based-indices"><i class="fa fa-check"></i><b>8.2.1</b> Catchability submodel for age based indices</a></li>
<li class="chapter" data-level="8.2.2" data-path="fitting.html"><a href="fitting.html#catchability-submodel-for-age-aggregated-biomass-indices"><i class="fa fa-check"></i><b>8.2.2</b> Catchability submodel for age aggregated biomass indices</a></li>
<li class="chapter" data-level="8.2.3" data-path="fitting.html"><a href="fitting.html#catchability-submodel-for-single-age-indices"><i class="fa fa-check"></i><b>8.2.3</b> Catchability submodel for single age indices</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="fitting.html"><a href="fitting.html#stock-recruitment-submodel-r_y"><i class="fa fa-check"></i><b>8.3</b> Stock-recruitment submodel (<span class="math inline">\(R_y\)</span>)</a></li>
<li class="chapter" data-level="8.4" data-path="fitting.html"><a href="fitting.html#observation-variance-submodel-sigma2_ay-tau2_ays"><i class="fa fa-check"></i><b>8.4</b> Observation variance submodel (<span class="math inline">\(\{\sigma^2_{ay}, \tau^2_{ays}\}\)</span>)</a></li>
<li class="chapter" data-level="8.5" data-path="fitting.html"><a href="fitting.html#initial-year-abundance-submodel-n_ay1"><i class="fa fa-check"></i><b>8.5</b> Initial year abundance submodel (<span class="math inline">\(N_{a,y=1}\)</span>)</a></li>
<li class="chapter" data-level="8.6" data-path="fitting.html"><a href="fitting.html#data-weigthing"><i class="fa fa-check"></i><b>8.6</b> Data weigthing</a></li>
<li class="chapter" data-level="8.7" data-path="fitting.html"><a href="fitting.html#working-with-covariates"><i class="fa fa-check"></i><b>8.7</b> Working with covariates</a></li>
<li class="chapter" data-level="8.8" data-path="fitting.html"><a href="fitting.html#assessing-files"><i class="fa fa-check"></i><b>8.8</b> Assessing files</a></li>
<li class="chapter" data-level="8.9" data-path="fitting.html"><a href="fitting.html#missing-observations-in-the-catch-matrix-or-index"><i class="fa fa-check"></i><b>8.9</b> Missing observations in the catch matrix or index</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="diagnostics.html"><a href="diagnostics.html"><i class="fa fa-check"></i><b>9</b> Diagnostics </a>
<ul>
<li class="chapter" data-level="9.1" data-path="diagnostics.html"><a href="diagnostics.html#residuals"><i class="fa fa-check"></i><b>9.1</b> Residuals</a></li>
<li class="chapter" data-level="9.2" data-path="diagnostics.html"><a href="diagnostics.html#predictive-skill"><i class="fa fa-check"></i><b>9.2</b> Predictive skill</a></li>
<li class="chapter" data-level="9.3" data-path="diagnostics.html"><a href="diagnostics.html#aggreagted-catch-in-weight"><i class="fa fa-check"></i><b>9.3</b> Aggreagted catch in weight</a></li>
<li class="chapter" data-level="9.4" data-path="diagnostics.html"><a href="diagnostics.html#fit-summary-information-and-cross-validation-metrics"><i class="fa fa-check"></i><b>9.4</b> Fit summary, information and cross-validation metrics</a></li>
<li class="chapter" data-level="9.5" data-path="diagnostics.html"><a href="diagnostics.html#the-package-a4adiags"><i class="fa fa-check"></i><b>9.5</b> The package a4adiags</a></li>
<li class="chapter" data-level="9.6" data-path="diagnostics.html"><a href="diagnostics.html#retrospective-analysis"><i class="fa fa-check"></i><b>9.6</b> Retrospective analysis</a></li>
<li class="chapter" data-level="9.7" data-path="diagnostics.html"><a href="diagnostics.html#hindcast"><i class="fa fa-check"></i><b>9.7</b> Hindcast</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="predict-and-simulate.html"><a href="predict-and-simulate.html"><i class="fa fa-check"></i><b>10</b> Predict and simulate </a>
<ul>
<li class="chapter" data-level="10.1" data-path="predict-and-simulate.html"><a href="predict-and-simulate.html#basic-functions"><i class="fa fa-check"></i><b>10.1</b> Basic functions}</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="predict-and-simulate.html"><a href="predict-and-simulate.html#simulate"><i class="fa fa-check"></i><b>10.1.1</b> simulate()</a></li>
<li class="chapter" data-level="10.1.2" data-path="predict-and-simulate.html"><a href="predict-and-simulate.html#genflquant"><i class="fa fa-check"></i><b>10.1.2</b> genFLQuant()</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="predict-and-simulate.html"><a href="predict-and-simulate.html#submodels"><i class="fa fa-check"></i><b>10.2</b> submodels</a></li>
<li class="chapter" data-level="10.3" data-path="predict-and-simulate.html"><a href="predict-and-simulate.html#predict"><i class="fa fa-check"></i><b>10.3</b> Predict</a></li>
<li class="chapter" data-level="10.4" data-path="predict-and-simulate.html"><a href="predict-and-simulate.html#simulate-1"><i class="fa fa-check"></i><b>10.4</b> Simulate</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><i class="fa fa-check"></i><b>11</b> The statistical catch-at-age stock assessment framework with Markov Chain Monte Carlo (MCMC) </a>
<ul>
<li class="chapter" data-level="11.1" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#the-mcmc-method-for-sca"><i class="fa fa-check"></i><b>11.1</b> The MCMC method for <code>sca</code></a></li>
<li class="chapter" data-level="11.2" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#diagnostics-with-coda"><i class="fa fa-check"></i><b>11.2</b> Diagnostics with CODA</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#traceplots"><i class="fa fa-check"></i><b>11.2.1</b> Traceplots</a></li>
<li class="chapter" data-level="11.2.2" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#autocorrelation-analysis"><i class="fa fa-check"></i><b>11.2.2</b> Autocorrelation analysis</a></li>
<li class="chapter" data-level="11.2.3" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#geweke-diagnostic"><i class="fa fa-check"></i><b>11.2.3</b> Geweke diagnostic</a></li>
<li class="chapter" data-level="11.2.4" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#cumulative-means"><i class="fa fa-check"></i><b>11.2.4</b> Cumulative means</a></li>
<li class="chapter" data-level="11.2.5" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#distribution-density"><i class="fa fa-check"></i><b>11.2.5</b> Distribution density</a></li>
<li class="chapter" data-level="11.2.6" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#gelman-rubin-statistic"><i class="fa fa-check"></i><b>11.2.6</b> Gelman-Rubin statistic</a></li>
<li class="chapter" data-level="11.2.7" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#acceptance-rate"><i class="fa fa-check"></i><b>11.2.7</b> Acceptance rate</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#admbs-arguments-to-tune-the-mcmc-algorithm"><i class="fa fa-check"></i><b>11.3</b> <code>ADMB</code>’s arguments to tune the MCMC algorithm</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#thinning-rate"><i class="fa fa-check"></i><b>11.3.1</b> Thinning rate</a></li>
<li class="chapter" data-level="11.3.2" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#mcscale-and-mcnoscale"><i class="fa fa-check"></i><b>11.3.2</b> mcscale and mcnoscale</a></li>
<li class="chapter" data-level="11.3.3" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#mcprobe"><i class="fa fa-check"></i><b>11.3.3</b> mcprobe</a></li>
<li class="chapter" data-level="11.3.4" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#mcrb"><i class="fa fa-check"></i><b>11.3.4</b> mcrb</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#references"><i class="fa fa-check"></i><b>11.4</b> References:</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html"><i class="fa fa-check"></i><b>12</b> Projections and harvest control rules</a>
<ul>
<li class="chapter" data-level="12.0.1" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html#references-1"><i class="fa fa-check"></i><b>12.0.1</b> References:</a></li>
<li class="chapter" data-level="12.1" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html#simple-workflow"><i class="fa fa-check"></i><b>12.1</b> Simple workflow</a></li>
<li class="chapter" data-level="12.2" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html#initial-condition-assumptions-check-fwdwindow"><i class="fa fa-check"></i><b>12.2</b> Initial condition assumptions [CHECK fwdWindow]</a></li>
<li class="chapter" data-level="12.3" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html#scenarios"><i class="fa fa-check"></i><b>12.3</b> Scenarios</a></li>
<li class="chapter" data-level="12.4" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html#relative-scenarios"><i class="fa fa-check"></i><b>12.4</b> Relative scenarios</a></li>
<li class="chapter" data-level="12.5" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html#limits"><i class="fa fa-check"></i><b>12.5</b> Limits</a></li>
<li class="chapter" data-level="12.6" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html#harvest-control-rule"><i class="fa fa-check"></i><b>12.6</b> Harvest Control Rule</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="reference-points.html"><a href="reference-points.html"><i class="fa fa-check"></i><b>13</b> Reference Points</a>
<ul>
<li class="chapter" data-level="13.1" data-path="reference-points.html"><a href="reference-points.html#yield-per-recruit-reference-points"><i class="fa fa-check"></i><b>13.1</b> Yield per recruit reference points</a></li>
<li class="chapter" data-level="13.2" data-path="reference-points.html"><a href="reference-points.html#stock-recruitment-relationship-based-reference-points"><i class="fa fa-check"></i><b>13.2</b> Stock recruitment relationship based reference points</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="reference-points.html"><a href="reference-points.html#stock-recruitment-after-fitting-the-stock-assessment-model"><i class="fa fa-check"></i><b>13.2.1</b> Stock recruitment after fitting the stock assessment model</a></li>
<li class="chapter" data-level="13.2.2" data-path="reference-points.html"><a href="reference-points.html#stock-recruitment-during-fitting-the-stock-assessment-model"><i class="fa fa-check"></i><b>13.2.2</b> Stock recruitment during fitting the stock assessment model</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="reference-points.html"><a href="reference-points.html#economics-reference-points"><i class="fa fa-check"></i><b>13.3</b> Economics reference points</a></li>
<li class="chapter" data-level="13.4" data-path="reference-points.html"><a href="reference-points.html#computing-user-specific-reference-points"><i class="fa fa-check"></i><b>13.4</b> Computing user specific reference points</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="propagate-uncertainty-into-stock-assessment.html"><a href="propagate-uncertainty-into-stock-assessment.html"><i class="fa fa-check"></i><b>14</b> Propagate uncertainty into stock assessment</a></li>
<li class="chapter" data-level="15" data-path="modelling-fleet-selectivity.html"><a href="modelling-fleet-selectivity.html"><i class="fa fa-check"></i><b>15</b> Modelling fleet selectivity</a></li>
<li class="chapter" data-level="16" data-path="modelling-spatial-effects.html"><a href="modelling-spatial-effects.html"><i class="fa fa-check"></i><b>16</b> Modelling spatial effects</a></li>
<li class="chapter" data-level="17" data-path="sections-to-be-added.html"><a href="sections-to-be-added.html"><i class="fa fa-check"></i><b>17</b> Sections to be added!?</a></li>
<li class="chapter" data-level="18" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html"><i class="fa fa-check"></i><b>18</b> Annex - stock assessment workflow</a>
<ul>
<li class="chapter" data-level="18.1" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html#the-mean-model"><i class="fa fa-check"></i><b>18.1</b> The “mean” model</a></li>
<li class="chapter" data-level="18.2" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html#the-age-effects"><i class="fa fa-check"></i><b>18.2</b> The age effects</a></li>
<li class="chapter" data-level="18.3" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html#the-fishing-mortality-year-model"><i class="fa fa-check"></i><b>18.3</b> The fishing mortality year model</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html#the-initial-year-population-abundance-model-aka-n1"><i class="fa fa-check"></i><b>18.3.1</b> The initial year population abundance model, aka N1</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html#the-stock-recruitment-submodel"><i class="fa fa-check"></i><b>18.4</b> The stock recruitment submodel</a></li>
<li class="chapter" data-level="18.5" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html#the-variance-submodel"><i class="fa fa-check"></i><b>18.5</b> The variance submodel</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Fish stock assessment with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="annex---stock-assessment-workflow" class="section level1 hasAnchor" number="18">
<h1><span class="header-section-number">18</span> Annex - stock assessment workflow<a href="annex---stock-assessment-workflow.html#annex---stock-assessment-workflow" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>[WHY? HOW!]</p>
<div id="the-mean-model" class="section level2 hasAnchor" number="18.1">
<h2><span class="header-section-number">18.1</span> The “mean” model<a href="annex---stock-assessment-workflow.html#the-mean-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To start the analysis we’ll fit a “mean” model, where all submodels will be set to an overall average, by using the <span class="math inline">\(\sim 1\)</span> formula. This will be our reference model to see how adding age and year effects will show up in the diagnostic tools, in particular in the residuals.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="annex---stock-assessment-workflow.html#cb326-1" tabindex="-1"></a><span class="fu">library</span>(FLa4a)</span>
<span id="cb326-2"><a href="annex---stock-assessment-workflow.html#cb326-2" tabindex="-1"></a><span class="fu">data</span>(hke1567)</span>
<span id="cb326-3"><a href="annex---stock-assessment-workflow.html#cb326-3" tabindex="-1"></a><span class="fu">data</span>(hke1567.idx)</span>
<span id="cb326-4"><a href="annex---stock-assessment-workflow.html#cb326-4" tabindex="-1"></a>fit01 <span class="ot">&lt;-</span> <span class="fu">sca</span>(hke1567, hke1567.idx, <span class="at">fmod=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">qmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="dv">1</span>), <span class="at">srmod=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">vmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="dv">1</span>, <span class="sc">~</span><span class="dv">1</span>),  <span class="at">n1mod=</span><span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb326-5"><a href="annex---stock-assessment-workflow.html#cb326-5" tabindex="-1"></a>res01 <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit01, hke1567, hke1567.idx)</span></code></pre></div>
<p>The common residuals plot clearly shows a trend across ages (Figure <a href="annex---stock-assessment-workflow.html#fig:meanresbyage">18.2</a>) for both datasets.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="annex---stock-assessment-workflow.html#cb327-1" tabindex="-1"></a><span class="fu">plot</span>(res01)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:meanresbyyear"></span>
<img src="_main_files/figure-html/meanresbyyear-1.png" alt="Mean fit residuals by year)" width="672" />
<p class="caption">
Figure 18.1: Mean fit residuals by year)
</p>
</div>
<p>Which is even clearer when plotting the residuals by age across years.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="annex---stock-assessment-workflow.html#cb328-1" tabindex="-1"></a><span class="fu">plot</span>(res01, <span class="at">auxline=</span><span class="st">&quot;l&quot;</span>, <span class="at">by=</span><span class="st">&quot;age&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:meanresbyage"></span>
<img src="_main_files/figure-html/meanresbyage-1.png" alt="Mean fit residuals by age)" width="25cm" height="18cm" angle=90 />
<p class="caption">
Figure 18.2: Mean fit residuals by age)
</p>
</div>
</div>
<div id="the-age-effects" class="section level2 hasAnchor" number="18.2">
<h2><span class="header-section-number">18.2</span> The age effects<a href="annex---stock-assessment-workflow.html#the-age-effects" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>These models will introduce age effects in the fishing mortality submodel and catchability submodel. First in the fishinf mortality submodel.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="annex---stock-assessment-workflow.html#cb329-1" tabindex="-1"></a>fit02 <span class="ot">&lt;-</span> <span class="fu">sca</span>(hke1567, hke1567.idx, <span class="at">fmod=</span><span class="sc">~</span><span class="fu">factor</span>(age), <span class="at">qmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="dv">1</span>), <span class="at">srmod=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">vmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="dv">1</span>, <span class="sc">~</span><span class="dv">1</span>),  <span class="at">n1mod=</span><span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb329-2"><a href="annex---stock-assessment-workflow.html#cb329-2" tabindex="-1"></a>res02 <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit02, hke1567, hke1567.idx)</span></code></pre></div>
<p>The residuals plot now shows catch at age residuals less stagered, reflecting the modelling of the age effect.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="annex---stock-assessment-workflow.html#cb330-1" tabindex="-1"></a><span class="fu">plot</span>(res02)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:fageresbyyear"></span>
<img src="_main_files/figure-html/fageresbyyear-1.png" alt="f age effect fit residuals by year)" width="672" />
<p class="caption">
Figure 18.3: f age effect fit residuals by year)
</p>
</div>
<p>The residuals plot by age shows the same outcome.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="annex---stock-assessment-workflow.html#cb331-1" tabindex="-1"></a><span class="fu">plot</span>(res02, <span class="at">auxline=</span><span class="st">&quot;l&quot;</span>, <span class="at">by=</span><span class="st">&quot;age&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:fageresbyage"></span>
<img src="_main_files/figure-html/fageresbyage-1.png" alt="f age effect fit residuals by age)" width="25cm" height="18cm" angle=90 />
<p class="caption">
Figure 18.4: f age effect fit residuals by age)
</p>
</div>
<p>Follwed by the same addition to the catchability model.</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="annex---stock-assessment-workflow.html#cb332-1" tabindex="-1"></a>fit03 <span class="ot">&lt;-</span> <span class="fu">sca</span>(hke1567, hke1567.idx, <span class="at">fmod=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">qmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="fu">factor</span>(age)), <span class="at">srmod=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">vmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="dv">1</span>, <span class="sc">~</span><span class="dv">1</span>),  <span class="at">n1mod=</span><span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb332-2"><a href="annex---stock-assessment-workflow.html#cb332-2" tabindex="-1"></a>res03 <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit03, hke1567, hke1567.idx)</span></code></pre></div>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="annex---stock-assessment-workflow.html#cb333-1" tabindex="-1"></a><span class="fu">plot</span>(res03)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:qageresbyyear"></span>
<img src="_main_files/figure-html/qageresbyyear-1.png" alt="q age effect fit residuals by year)" width="672" />
<p class="caption">
Figure 18.5: q age effect fit residuals by year)
</p>
</div>
<p>The residuals plot by age shows the same outcome.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="annex---stock-assessment-workflow.html#cb334-1" tabindex="-1"></a><span class="fu">plot</span>(res03, <span class="at">auxline=</span><span class="st">&quot;l&quot;</span>, <span class="at">by=</span><span class="st">&quot;age&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:qageresbyage"></span>
<img src="_main_files/figure-html/qageresbyage-1.png" alt="q age effect fit residuals by age)" width="25cm" height="18cm" angle=90 />
<p class="caption">
Figure 18.6: q age effect fit residuals by age)
</p>
</div>
<p>Finally both effects are brought together.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="annex---stock-assessment-workflow.html#cb335-1" tabindex="-1"></a>fit04 <span class="ot">&lt;-</span> <span class="fu">sca</span>(hke1567, hke1567.idx, <span class="at">fmod=</span><span class="sc">~</span><span class="fu">factor</span>(age), <span class="at">qmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="fu">factor</span>(age)), <span class="at">srmod=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">vmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="dv">1</span>, <span class="sc">~</span><span class="dv">1</span>),  <span class="at">n1mod=</span><span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb335-2"><a href="annex---stock-assessment-workflow.html#cb335-2" tabindex="-1"></a>res04 <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit04, hke1567, hke1567.idx)</span></code></pre></div>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="annex---stock-assessment-workflow.html#cb336-1" tabindex="-1"></a><span class="fu">plot</span>(res04)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:fqageresbyyear"></span>
<img src="_main_files/figure-html/fqageresbyyear-1.png" alt="q age effect fit residuals by year)" width="672" />
<p class="caption">
Figure 18.7: q age effect fit residuals by year)
</p>
</div>
<p>The residuals plot by age shows the same outcome.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="annex---stock-assessment-workflow.html#cb337-1" tabindex="-1"></a><span class="fu">plot</span>(res04, <span class="at">auxline=</span><span class="st">&quot;l&quot;</span>, <span class="at">by=</span><span class="st">&quot;age&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:fqageresbyage"></span>
<img src="_main_files/figure-html/fqageresbyage-1.png" alt="q age effect fit residuals by age)" width="25cm" height="18cm" angle=90 />
<p class="caption">
Figure 18.8: q age effect fit residuals by age)
</p>
</div>
</div>
<div id="the-fishing-mortality-year-model" class="section level2 hasAnchor" number="18.3">
<h2><span class="header-section-number">18.3</span> The fishing mortality year model<a href="annex---stock-assessment-workflow.html#the-fishing-mortality-year-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This model will introduce an year effect in the fishing mortality submodel on top of the F age effect added before.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="annex---stock-assessment-workflow.html#cb338-1" tabindex="-1"></a>fit05 <span class="ot">&lt;-</span> <span class="fu">sca</span>(hke1567, hke1567.idx, <span class="at">fmod=</span><span class="sc">~</span><span class="fu">factor</span>(age) <span class="sc">+</span> <span class="fu">factor</span>(year), <span class="at">qmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="dv">1</span>), <span class="at">srmod=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">vmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="dv">1</span>, <span class="sc">~</span><span class="dv">1</span>),  <span class="at">n1mod=</span><span class="sc">~</span><span class="dv">1</span>)</span>
<span id="cb338-2"><a href="annex---stock-assessment-workflow.html#cb338-2" tabindex="-1"></a>res05 <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit05, hke1567, hke1567.idx)</span></code></pre></div>
<p>The residuals plot now shows catch at age residuals stagered as before. The year trends are less pronounced although, because the data doesn’t have a very strong year effect, it’s less clear than when modelling the age effect.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="annex---stock-assessment-workflow.html#cb339-1" tabindex="-1"></a><span class="fu">plot</span>(res05)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:fyearresbyyear"></span>
<img src="_main_files/figure-html/fyearresbyyear-1.png" alt="f year effect fit residuals by year)" width="672" />
<p class="caption">
Figure 18.9: f year effect fit residuals by year)
</p>
</div>
<p>The residuals plot by age shows the same outcome.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="annex---stock-assessment-workflow.html#cb340-1" tabindex="-1"></a><span class="fu">plot</span>(res05, <span class="at">auxline=</span><span class="st">&quot;l&quot;</span>, <span class="at">by=</span><span class="st">&quot;age&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:fyearresbyage"></span>
<img src="_main_files/figure-html/fyearresbyage-1.png" alt="f year effect fit residuals by age)" width="25cm" height="18cm" angle=90 />
<p class="caption">
Figure 18.10: f year effect fit residuals by age)
</p>
</div>
<p>We can see now that the residuals show a lot less patterns than before. There’s still some issues, the survey catchability seems to have an year trend. However the model is not fully specified yet, stock recruitment is modelled as constant over time, the initial population abundance is also modelled as a constant as well as the variance models.</p>
<div id="the-initial-year-population-abundance-model-aka-n1" class="section level3 hasAnchor" number="18.3.1">
<h3><span class="header-section-number">18.3.1</span> The initial year population abundance model, aka N1<a href="annex---stock-assessment-workflow.html#the-initial-year-population-abundance-model-aka-n1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This model will introduce an age effect in the population abundance in the first year of the time series. This model sets the n-at-age in the first year of the time series, which is needed due to the lack of previous data to reconstruct those cohorts.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="annex---stock-assessment-workflow.html#cb341-1" tabindex="-1"></a>fit06 <span class="ot">&lt;-</span> <span class="fu">sca</span>(hke1567, hke1567.idx, <span class="at">fmod=</span><span class="sc">~</span><span class="fu">factor</span>(age) <span class="sc">+</span> <span class="fu">factor</span>(year), <span class="at">qmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="fu">factor</span>(age)), <span class="at">srmod=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">vmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="dv">1</span>, <span class="sc">~</span><span class="dv">1</span>),  <span class="at">n1mod=</span><span class="sc">~</span><span class="fu">factor</span>(age))</span>
<span id="cb341-2"><a href="annex---stock-assessment-workflow.html#cb341-2" tabindex="-1"></a>res06 <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit06, hke1567, hke1567.idx)</span></code></pre></div>
<p>The residuals plot now shows catch at age residuals stagered as before. The year trends are less pronounced although, because the data doesn’t have a very strong year effect, it’s less clear than when modelling the age effect.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="annex---stock-assessment-workflow.html#cb342-1" tabindex="-1"></a><span class="fu">plot</span>(res06)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:n1arresbyyear"></span>
<img src="_main_files/figure-html/n1arresbyyear-1.png" alt="f year effect fit residuals by year)" width="672" />
<p class="caption">
Figure 18.11: f year effect fit residuals by year)
</p>
</div>
<p>The residuals by age (Figure <a href="annex---stock-assessment-workflow.html#fig:n1resbyage">18.12</a>) the residuals’ improvement in the first year of the catch at age time series (bottom left plots).</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="annex---stock-assessment-workflow.html#cb343-1" tabindex="-1"></a><span class="fu">plot</span>(res06, <span class="at">auxline=</span><span class="st">&quot;l&quot;</span>, <span class="at">by=</span><span class="st">&quot;age&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:n1resbyage"></span>
<img src="_main_files/figure-html/n1resbyage-1.png" alt="f year effect fit residuals by age)" width="25cm" height="18cm" angle=90 />
<p class="caption">
Figure 18.12: f year effect fit residuals by age)
</p>
</div>
</div>
</div>
<div id="the-stock-recruitment-submodel" class="section level2 hasAnchor" number="18.4">
<h2><span class="header-section-number">18.4</span> The stock recruitment submodel<a href="annex---stock-assessment-workflow.html#the-stock-recruitment-submodel" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this example we’ll simply add a model to allow recruitment to vary over time and we’ll see how to track potential improvements in the residuals.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="annex---stock-assessment-workflow.html#cb344-1" tabindex="-1"></a>fit07 <span class="ot">&lt;-</span> <span class="fu">sca</span>(hke1567, hke1567.idx, <span class="at">fmod=</span><span class="sc">~</span><span class="fu">factor</span>(age) <span class="sc">+</span> <span class="fu">factor</span>(year), <span class="at">qmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="fu">factor</span>(age)), <span class="at">srmod=</span><span class="sc">~</span><span class="fu">factor</span>(year), <span class="at">vmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="dv">1</span>, <span class="sc">~</span><span class="dv">1</span>),  <span class="at">n1mod=</span><span class="sc">~</span><span class="fu">factor</span>(age))</span>
<span id="cb344-2"><a href="annex---stock-assessment-workflow.html#cb344-2" tabindex="-1"></a>res07 <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit07, hke1567, hke1567.idx)</span></code></pre></div>
<p>The residuals plot by year are very useful to see the effect of adding a varying stock recruitment model. The year trends present in previous models are not absent. Recruitment variability when left unmodelled was being picked up by trends in the survey catchability and catch at age. And due to the cohort dynamics underlying the catch at age model, where propagating into other ages’ estimates.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="annex---stock-assessment-workflow.html#cb345-1" tabindex="-1"></a><span class="fu">plot</span>(res07)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:srresbyyear"></span>
<img src="_main_files/figure-html/srresbyyear-1.png" alt="f year effect fit residuals by year)" width="672" />
<p class="caption">
Figure 18.13: f year effect fit residuals by year)
</p>
</div>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="annex---stock-assessment-workflow.html#cb346-1" tabindex="-1"></a><span class="fu">plot</span>(res07, <span class="at">auxline=</span><span class="st">&quot;l&quot;</span>, <span class="at">by=</span><span class="st">&quot;age&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:srresbyage"></span>
<img src="_main_files/figure-html/srresbyage-1.png" alt="f year effect fit residuals by age)" width="25cm" height="18cm" angle=90 />
<p class="caption">
Figure 18.14: f year effect fit residuals by age)
</p>
</div>
</div>
<div id="the-variance-submodel" class="section level2 hasAnchor" number="18.5">
<h2><span class="header-section-number">18.5</span> The variance submodel<a href="annex---stock-assessment-workflow.html#the-variance-submodel" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Finally, we’re testing the variance submodel, specifically the catch at age variance model. We won’t dig into the catchability variance model though. It’s common to accept that a scientific survey following a well designed sampling protocol will have equal variance across ages since no preferential areas are sampled.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="annex---stock-assessment-workflow.html#cb347-1" tabindex="-1"></a>fit10 <span class="ot">&lt;-</span> <span class="fu">sca</span>(hke1567, hke1567.idx, <span class="at">fmod=</span><span class="sc">~</span><span class="fu">factor</span>(age) <span class="sc">+</span> <span class="fu">s</span>(year, <span class="at">k=</span><span class="dv">10</span>), <span class="at">qmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="fu">factor</span>(age)), <span class="at">srmod=</span><span class="sc">~</span><span class="fu">s</span>(year, <span class="at">k=</span><span class="dv">10</span>), <span class="at">vmod=</span><span class="fu">list</span>(<span class="sc">~</span><span class="fu">factor</span>(age), <span class="sc">~</span><span class="dv">1</span>),  <span class="at">n1mod=</span><span class="sc">~</span><span class="fu">factor</span>(age))</span>
<span id="cb347-2"><a href="annex---stock-assessment-workflow.html#cb347-2" tabindex="-1"></a>res10 <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit10, hke1567, hke1567.idx)</span></code></pre></div>
<p>To see what’s happening with the variance model one can use predict to plot the different models fitted.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="annex---stock-assessment-workflow.html#cb348-1" tabindex="-1"></a>flqs <span class="ot">&lt;-</span> <span class="fu">FLQuants</span>(<span class="at">mod10=</span><span class="fu">predict</span>(fit10)<span class="sc">$</span>vmodel<span class="sc">$</span>catch[,<span class="st">&quot;2022&quot;</span>], <span class="at">mod07=</span><span class="fu">predict</span>(fit07)<span class="sc">$</span>vmodel<span class="sc">$</span>catch[,<span class="st">&quot;2022&quot;</span>])</span>
<span id="cb348-2"><a href="annex---stock-assessment-workflow.html#cb348-2" tabindex="-1"></a><span class="fu">xyplot</span>(data<span class="sc">~</span>age, <span class="at">data=</span>flqs, <span class="at">group=</span>qname, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">auto.key=</span>T)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:vagepredbyage"></span>
<img src="_main_files/figure-html/vagepredbyage-1.png" alt="Variance models for catch at age" width="672" />
<p class="caption">
Figure 18.15: Variance models for catch at age
</p>
</div>
<p>To see the effect these models have on the estimated quantities one can look at the variance of the estimates:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="annex---stock-assessment-workflow.html#cb349-1" tabindex="-1"></a>flqs <span class="ot">&lt;-</span> <span class="fu">FLQuants</span>(<span class="at">mod10=</span><span class="fu">catch.n</span>(hke1567<span class="sc">+</span><span class="fu">simulate</span>(fit10, <span class="at">nsim=</span><span class="dv">500</span>))[,<span class="st">&quot;2022&quot;</span>], <span class="at">mod07=</span><span class="fu">catch.n</span>(hke1567<span class="sc">+</span><span class="fu">simulate</span>(fit07, <span class="at">nsim=</span><span class="dv">500</span>))[,<span class="st">&quot;2022&quot;</span>])</span>
<span id="cb349-2"><a href="annex---stock-assessment-workflow.html#cb349-2" tabindex="-1"></a><span class="fu">bwplot</span>(data<span class="sc">~</span>qname<span class="sc">|</span><span class="fu">factor</span>(age),  <span class="at">data=</span><span class="fu">as.data.frame</span>(flqs), <span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">auto.key=</span>T)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:vage"></span>
<img src="_main_files/figure-html/vage-1.png" alt="Estimates of population abundance with different variance models" width="672" />
<p class="caption">
Figure 18.16: Estimates of population abundance with different variance models
</p>
</div>
<p>and the usual residuals</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="annex---stock-assessment-workflow.html#cb350-1" tabindex="-1"></a><span class="fu">plot</span>(res10, <span class="at">auxline=</span><span class="st">&quot;r&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:vageresbyyear"></span>
<img src="_main_files/figure-html/vageresbyyear-1.png" alt="f year effect fit residuals by year)" width="672" />
<p class="caption">
Figure 18.17: f year effect fit residuals by year)
</p>
</div>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="annex---stock-assessment-workflow.html#cb351-1" tabindex="-1"></a><span class="fu">plot</span>(res10, <span class="at">auxline=</span><span class="st">&quot;l&quot;</span>, <span class="at">by=</span><span class="st">&quot;age&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:vageresbyage"></span>
<img src="_main_files/figure-html/vageresbyage-1.png" alt="f year effect fit residuals by age)" width="25cm" height="18cm" angle=90 />
<p class="caption">
Figure 18.18: f year effect fit residuals by age)
</p>
</div>

</div>
</div>






            </section>

          </div>
        </div>
      </div>
<a href="sections-to-be-added.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/30-annexworkflow.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
