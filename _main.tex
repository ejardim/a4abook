% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\usepackage{a4a}
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Fish stock assessment with R},
  pdfauthor={John Doe and friends},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Fish stock assessment with R}
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{The a4a Initiative}
\author{John Doe and friends}
\date{2025-01-17}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{cover-image-path-to-the-social-sharing-image-like-imagescover.jpg}{%
\chapter{cover-image: path to the social sharing image like images/cover.jpg}\label{cover-image-path-to-the-social-sharing-image-like-imagescover.jpg}}

Placeholder

\hypertarget{license-documentation-and-development-status}{%
\section{License, documentation and development status}\label{license-documentation-and-development-status}}

\hypertarget{installing-and-loading-libraries}{%
\section{Installing and loading libraries}\label{installing-and-loading-libraries}}

\hypertarget{how-to-read-this-document}{%
\section{How to read this document}\label{how-to-read-this-document}}

\hypertarget{how-to-get-help}{%
\section{How to get help}\label{how-to-get-help}}

\hypertarget{notation}{%
\section{Notation}\label{notation}}

\hypertarget{introduction}{%
\chapter{Introduction}\label{introduction}}

Placeholder

\hypertarget{the-assessment-for-all-initiative-a4a}{%
\section{The ``Assessment for All'' Initiative (a4a)}\label{the-assessment-for-all-initiative-a4a}}

\hypertarget{multi-stage-modelling-approach}{%
\section{Multi-stage modelling approach}\label{multi-stage-modelling-approach}}

\hypertarget{stock-assessment-process}{%
\section{Stock Assessment Process}\label{stock-assessment-process}}

\hypertarget{stock-assessment-as-a-linear-model}{%
\section{Stock assessment as a linear model}\label{stock-assessment-as-a-linear-model}}

\hypertarget{data-used-in-the-book}{%
\section{Data used in the book}\label{data-used-in-the-book}}

\hypertarget{plaice-in-area-fao-27-ices-area-iv}{%
\subsection{Plaice in area FAO 27, ICES area IV}\label{plaice-in-area-fao-27-ices-area-iv}}

\hypertarget{stock-xx}{%
\subsection{stock xx}\label{stock-xx}}

\hypertarget{stock-xx-1}{%
\subsection{stock xx}\label{stock-xx-1}}

\hypertarget{introduction-to-splines}{%
\chapter{Introduction to Splines}\label{introduction-to-splines}}

Placeholder

\hypertarget{understanding-spline-basics}{%
\section{Understanding Spline Basics}\label{understanding-spline-basics}}

\hypertarget{generate-some-artificial-data}{%
\section{Generate some artificial data}\label{generate-some-artificial-data}}

\hypertarget{cubic-regression-splines}{%
\section{Cubic Regression Splines}\label{cubic-regression-splines}}

\hypertarget{thin-plate-spline}{%
\section{Thin plate spline}\label{thin-plate-spline}}

\hypertarget{comparison}{%
\section{Comparison}\label{comparison}}

\hypertarget{the-mgcv-package-inside-a4a}{%
\section{\texorpdfstring{The \texttt{mgcv} package inside \texttt{a4a}}{The mgcv package inside a4a}}\label{the-mgcv-package-inside-a4a}}

\hypertarget{on-the-number-of-knots-k}{%
\section{\texorpdfstring{On the number of knots \(k\)}{On the number of knots k}}\label{on-the-number-of-knots-k}}

\hypertarget{modelling-individual-growth-and-using-stochastic-slicing-to-convert-length-based-data-into-age-based-data}{%
\chapter{Modelling Individual Growth and Using Stochastic Slicing to Convert Length-based Data Into Age-based Data}\label{modelling-individual-growth-and-using-stochastic-slicing-to-convert-length-based-data-into-age-based-data}}

Placeholder

\hypertarget{a4agr---the-growth-class}{%
\section{a4aGr - The growth class}\label{a4agr---the-growth-class}}

\hypertarget{adding-uncertainty-to-growth-parameters-with-a-multivariate-normal-distribution}{%
\section{Adding uncertainty to growth parameters with a multivariate normal distribution\}}\label{adding-uncertainty-to-growth-parameters-with-a-multivariate-normal-distribution}}

\hypertarget{adding-uncertainty-to-growth-parameters-with-a-multivariate-triangle-distribution}{%
\section{Adding uncertainty to growth parameters with a multivariate triangle distribution\}}\label{adding-uncertainty-to-growth-parameters-with-a-multivariate-triangle-distribution}}

\hypertarget{adding-uncertainty-to-growth-parameters-with-statistical-copulas}{%
\section{Adding uncertainty to growth parameters with statistical copulas\}}\label{adding-uncertainty-to-growth-parameters-with-statistical-copulas}}

\hypertarget{converting-from-length-to-age-based-data---the-l2a-method}{%
\section{\texorpdfstring{Converting from length to age based data - the \texttt{l2a()} method\}}{Converting from length to age based data - the l2a() method\}}}\label{converting-from-length-to-age-based-data---the-l2a-method}}

\hypertarget{modelling-natural-mortality}{%
\chapter{Modelling Natural Mortality}\label{modelling-natural-mortality}}

Placeholder

\hypertarget{a4am---the-m-class}{%
\section{\texorpdfstring{\texttt{a4aM} - The M class}{a4aM - The M class}}\label{a4am---the-m-class}}

\hypertarget{adding-uncertainty-to-natural-mortality-parameters-with-a-multivariate-normal-distribution}{%
\section{Adding uncertainty to natural mortality parameters with a multivariate normal distribution}\label{adding-uncertainty-to-natural-mortality-parameters-with-a-multivariate-normal-distribution}}

\hypertarget{adding-uncertainty-to-natural-mortality-parameters-with-statistical-copulas}{%
\section{Adding uncertainty to natural mortality parameters with statistical copulas}\label{adding-uncertainty-to-natural-mortality-parameters-with-statistical-copulas}}

\hypertarget{computing-natural-mortality-time-series---the-m-method}{%
\section{Computing natural mortality time series - the ``m'' method}\label{computing-natural-mortality-time-series---the-m-method}}

\hypertarget{stock-assessment-framework}{%
\chapter{Stock assessment framework}\label{stock-assessment-framework}}

\hypertarget{maths-description}{%
\section{\texorpdfstring{Maths description \label{sec:math}}{Maths description }}\label{maths-description}}

\hypertarget{observations}{%
\subsection{Observations}\label{observations}}

The stock assessment model is based on two types of observations: catches, \(\hat{C}\), and abundance indices, \(\hat{I}\). The model predicts catches at age \(C_{ay}\) and indices of abundance \(I_{ays}\) for each age \(a\), year \(y\) and survey \(s\) in the input dataset. It is assumed that the observed catches are normally distributed about the model predictions on the log scale with some observation variance \(\sigma^2_{ay}\). that is:

\[\log \hat{C}_{ay} \sim \text{Normal} \Big( \log C_{ay}, \sigma^2_{ay}\Big)\]

likewise, the observed survey indices are assumed to be normally distributed about the model predictions on the log scale with some observation variance \(\tau^2_{ays}\):

\[\log \hat{I}_{ays} \sim \text{Normal} \Big( \log I_{ays}, \tau^2_{ays} \Big)\]

This leads to the definition of the log-likelihood of the observed catches

\[\ell_C = \sum_{ay} w^{(c)}_{ay}\ \ell_N \Big( \log C_{ay}, \sigma^2_{ay} ;\ \log \hat{C}_{ay} \Big)\]

and the log-likelihood of the observed survey indices

\[\ell_I = \sum_s \sum_{ay} w^{(s)}_{ays}\ \ell_N \Big( \log I_{ays}, \tau_{ays}^2 ;\ \log \hat{I}_{ays} \Big)\]

where \(\ell_N\) is the normal log-likelihood function and \(w^{(c)}_{ay}\) and \(w^{(s)}_{ays}\) are optional weights for the catch and index observations, respectively. The total log-likelihood is then

\[\ell = \ell_C + \ell_I\]

\hypertarget{the-population-dynamics-model}{%
\subsection{The population dynamics model}\label{the-population-dynamics-model}}

To predict catches and survey indices, the model uses the standard population dynamics model

\[N_{a+1,y+1} = N_{ay} \exp \left( - F_{ay} - M_{ay} \right)\]

where \(N_{ay}\) is the number of individuals at age \(a\) in year \(y\), \(F_{ay}\) is the fishing mortality at age \(a\) in year \(y\), and \(M_{ay}\) is the natural mortality at age \(a\) in year \(y\). Any fish that survived beyond the oldest age \(A\) in the model are accumulated in the oldest age group and are assumed to be fished at a common rate \(F_{A,y}\).

The numbers \(N_{a,y}\) are initiated in the first year, \(y=1\) and at the youngest age, \(a=1\), and the matrix of numbers at age are filled in according to the population dynamics model stated above.

\includegraphics{figure/sca_matrix.png}

Defining \(R_y = N_{1,y}\), the numbers at age can be written (ignoring the plus group) as:


Catches in numbers by age and year are defined in terms of the three quantities: natural mortality, fishing mortality and recruitment; using a modified form of the well known Baranov catch equation:

\[C_{ay} = \frac{F_{ay}}{F_{ay}+M_{ay}}\left(1 - e^{-(F_{ay}+M_{ay})}\right) R_{y}e^{-\sum (F_{ay} + M_{ay})} \]

Survey indices by age and year are defined in terms of the same three quantities with the addition of survey catchability:

\[I_{ays} = Q_{ays} R_{y}e^{-\sum (F_{ay} + M_{ay})}\]

Observed catches and observed survey indices are assumed to be log-normally distributed, or equivalently, normally distributed on the log-scale, with specific observation variance:

\[ \log \hat{C}_{ay} \sim \text{Normal} \Big( \log C_{ay}, \sigma^2_{ay}\Big) \]
\[ \log \hat{I}_{ays} \sim \text{Normal} \Big( \log I_{ays}, \tau^2_{ays} \Big) \]

The log-likelihood can now be defined as the sum of the log-likelihood of the observed catches:

\[  \ell_C = \sum_{ay} w^{(c)}_{ay}\ \ell_N \Big( \log C_{ay}, \sigma^2_{ay} ;\ \log \hat{C}_{ay} \Big) \]

and the log-likelihood of the observed survey indices as:

\[  \ell_I = \sum_s \sum_{ay} w^{(s)}_{ays}\ \ell_N \Big( \log I_{ays}, \tau_{ays}^2 ;\ \log \hat{I}_{ays} \Big)\]

giving the total log-likelihood

\[\ell = \ell_C + \ell_I\]

which is defined in terms of the strictly positive quantites, \(M_{ay}\), \(F_{ay}\), \(Q_{ays}\) and \(R_{y}\), and the observation variances \(\sigma_{ay}\) and \(\tau_{ays}\). As such, the log-likelihood is over-parameterised as there are many more parameters than observations. In order to reduce the number of parameters, \(M_{ay}\) is assumed known (as is common).

\%====================================================================
\%THE FOLLOWING NEEDS REVISION, need to bring in N1 submod
\%====================================================================

The remaining parameters are written in terms of a linear combination of covariates \(x_{ayk}\), e.g.

\[\log F_{ay} = \sum_k \beta_k x_{ayk}\]

where \(k\) is the number of parameters to be estimated and is sufficiently small. Using this tecnique the quantities \(\log F\), \(\log Q\), \(\log \sigma\) and \(\log \tau\)
\%\(\log \text{initial\,age\,structure}\) \% this is not present in the above
(in bold in the equations above) can be described by a reduced number of parameters. The following section has more discussion on the use of linear models in a4a.

\%====================================================================

The a4a statistical catch-at-age model can addionally allow for a functional relationship that links predicted recruitment \(\tilde{R}\) based on spawning stock biomass and modelled recruitment \(R\), to be imposed as a fixed variance random effect. {[}NEEDS REVISION, sentence not clear{]}

Options for the relationship are the hard coded models Ricker, Beverton Holt, smooth hockeystick or geometric mean. This is implemented by including a third component in the log-likelihood:

\[\ell_{SR} = \sum_y \ell_N \Big( \log \tilde{R}_y(a, b), \phi_y^2 ;\ \log R_y \Big)\]

giving the total log-likelihood

\[\ell = \ell_C + \ell_I + \ell_{SR}\]

Using the (time varying) Ricker model as an example, predicted recruitment is

\[\tilde{R}_y(a_y,b_y) = a_y S_{y-1} e^{-b_y S_{y-1}}\]

where \(S\) is spawning stock biomass derived from the model parameters \(F\) and \(R\), and the fixed quantites \(M\) and mean weights by year and age. It is assumed that \(R\) is log-normally distributed, or equivalently, normally distributed on the log-scale about the (log) recruitment predicted by the SR model \(\tilde{R}\), with known variance \(\phi^2\), i.e.

\[\log R_y \sim \text{Normal} \Big( \log \tilde{R}_y, \phi_y^2 \Big)\]

which leads to the definition of \(\ell_{SR}\) given above. In all cases \(a\) and \(b\) are strictly positive, and with the quantities \(F\), \(R\), etc. linear models are used to parameterise \(\log a\) and/or \(\log b\), where relevant.

\%====================================================================
\%THE FOLLOWING NEEDS REVISION, this is not just the default I guess,
\% it's always present since R predictions will be a mix of S/R and \(\gamma\)
\%====================================================================

By default, recruitment \(R\) as apposed to the reruitment predicted from a stock recruitment model \(\tilde{R}\), is specified as a linear model with a parameter for each year, i.e.

\[\log R_y = \gamma_y\]

This is to allow modelled recruitment \(R_y\) to be shrunk towards the stock recruitment model. However, if it is considered appropriate that recruitment can be determined exactly by a relationship with covariates, it is possible, to instead define \(\log R\) in terms of a linear model in the same way as \(\log F\), \(\log Q\), \(\log \sigma\) and \(\log \tau\). \%But this is pretty much the same as taking a geometric mean, with a model on log a, and making the variance very small.

\%====================================================================
\% WE NEED TO ADD SOMETHING ABOUT HOW THE PLUSGROUP IS MODELLED
\%====================================================================

\hypertarget{classes-description}{%
\section{\texorpdfstring{Classes Description \label{sec:classes}}{Classes Description }}\label{classes-description}}

Figure \ref{fig:sca} illustrates the input/output model of the statistical stock assessment method based on catch-at-age data.

\begin{figure}
\centering
\includegraphics{scamethod.png}
\caption{Figure: \label{fig:sca} The fit process}
\end{figure}

The \texttt{type} argument in the \texttt{sca} function defines the fitting method---either maximum likelihood or MCMC---and specifies whether the variance-covariance matrix of the parameters is calculated and returned in the case of maximum likelihood. The resulting object belongs to a specific class, depending on the selected options. The data structure used to store and report the fitting process follows an object-oriented paradigm (e.g., the S4 system in R) and is hierarchically organized. The primary class, \texttt{a4aFit}, is extended by \texttt{a4aFitSA} and \texttt{a4aFitMCMC} for specific configurations.

\begin{longtable}[]{@{}llll@{}}
\caption{\label{tab:scatype} Fit Types and Associated Classes}\tabularnewline
\toprule\noalign{}
Type of Fit & Fit Method & Variance-Covariance Matrix & Output Object Class \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
Type of Fit & Fit Method & Variance-Covariance Matrix & Output Object Class \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
MP & Maximum Likelihood & No & \texttt{a4aFit} \\
Assessment & Maximum Likelihood & Yes & \texttt{a4aFitSA} \\
MCMC & MCMC & Yes & \texttt{a4aFitMCMC} \\
\end{longtable}

Type \texttt{MP}, representing ``Management Procedure,'' returns an \texttt{a4aFit} class object designed for use in MSEs (Management Strategy Evaluations) with full feedback models (REF PUNT and KELL). Inverting the Jacobian to compute the variance-covariance matrix is computationally intensive in maximum likelihood models, and as MSE analyses often involve thousands of iterations, using \texttt{type="MP"} significantly speeds up the process. This option is advantageous for scenarios requiring multiple model fits. However, the lack of immediate feedback on model convergence is a drawback, as convergence is assessed by inverting the Jacobian. A failed inversion indicates non-convergence. Table \ref{tab:a4afitclass} describes the composition of the \texttt{a4aFit} class.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2500}}@{}}
\caption{\label{tab:a4afitclass} \texttt{a4aFit} Class Description}\tabularnewline
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Class
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Slots
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Slot's Class
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Description
\end{minipage} \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Class
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Slots
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Slot's Class
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Description
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
a4aFit & call & call & Code used to run the analysis \\
& catch.n & FLQuant & Catch numbers at age and year \\
& clock & numeric & Time to run the analysis \\
& desc & character & Description of the stock and/or analysis \\
& fitSumm & array & Summary statistics of the fit (e.g., number of data points) \\
& harvest & FLQuant & Fishing mortality at age and year \\
& index & FLQuants & Indices of abundance (age/biomass, by year) \\
& name & character & Stock name \\
& range & numeric & Age and year range of the data \\
& stock.n & FLQuant & Population in numbers (age and year) \\
\end{longtable}

The \texttt{a4aFitSA} and \texttt{a4aFitMCMC} classes extend \texttt{a4aFit}, retaining all its slots while adding a \texttt{pars} slot of class \texttt{SCAPars}. Table \ref{tab:a4afitSAclass} outlines these classes.

\begin{longtable}[]{@{}llll@{}}
\caption{\label{tab:a4afitSAclass} \texttt{a4aFitSA} and \texttt{a4aFitMCMC} Class Description}\tabularnewline
\toprule\noalign{}
Class & Slots & Slot's Class & Description \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
Class & Slots & Slot's Class & Description \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
a4aFitSA & All \texttt{a4aFit} & & Inherited from \texttt{a4aFit} \\
& pars & SCAPars & Parameter information \\
a4aFitMCMC & All \texttt{a4aFit} & & Inherited from \texttt{a4aFit} \\
& pars & SCAPars & Parameter information \\
\end{longtable}

The \texttt{SCAPars} class stores details about submodel parameters, such as formulas and distributions, and includes three slots: \texttt{stkmodel} for stock model parameters, \texttt{qmodel} for catchability parameters, and \texttt{vmodel} for variance parameters. Table \ref{tab:SCAParsclass} describes this class.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 6\tabcolsep) * \real{0.2500}}@{}}
\caption{\label{tab:SCAParsclass} \texttt{SCAPars} Class Description}\tabularnewline
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Class
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Slots
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Slot's Class
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Description
\end{minipage} \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Class
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Slots
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Slot's Class
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Description
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
SCAPars & stkmodel & a4aStkParams & Details of fishing mortality, stock recruitment, and initial stock numbers \\
& qmodel & submodel & Details of catchability parameters \\
& vmodel & submodel & Details of variance parameters \\
\end{longtable}

The \texttt{stkmodel} slot encompasses parameters for fishing mortality, stock recruitment, and initial stock numbers. Due to potential correlations among these parameters, their variance-covariance matrix is reported collectively. Table \ref{tab:a4aStkParamsclass} describes the slots of the \texttt{a4aStkParams} class.

\begin{longtable}[]{@{}llll@{}}
\caption{\label{tab:a4aStkParamsclass} \texttt{a4aStkParams} Class Description}\tabularnewline
\toprule\noalign{}
Class & Slots & Slot's Class & Description \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
Class & Slots & Slot's Class & Description \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
a4aStkParams & centering & FLPar & Centering parameters \\
& coefficients & FLPar & Model coefficients \\
& desc & character & Description \\
& distr & character & Distributions \\
& fMod & formula & Fishing mortality model \\
& link & function & Link function \\
& linkinv & function & Inverse link function \\
& m & FLQuant & Mortality parameters \\
& mat & FLQuant & Maturity parameters \\
& n1Mod & formula & Initial stock numbers model \\
& name & character & Stock name \\
& range & numeric & Age and year range \\
& srMod & formula & Stock-recruitment model \\
& units & character & Units of measurement \\
& vcov & array & Variance-covariance matrix \\
& wt & FLQuant & Weights \\
\end{longtable}

The \texttt{qmodel} and \texttt{vmodel} slots share the \texttt{submodel} class, which describes single submodels. Table \ref{tab:submodelclass} provides details.

\begin{longtable}[]{@{}llll@{}}
\caption{\label{tab:submodelclass} \texttt{submodel} Class Description}\tabularnewline
\toprule\noalign{}
Class & Slots & Slot's Class & Description \\
\midrule\noalign{}
\endfirsthead
\toprule\noalign{}
Class & Slots & Slot's Class & Description \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
submodel & centering & FLPar & Centering parameters \\
& coefficients & FLPar & Model coefficients \\
& desc & character & Description \\
& distr & character & Distributions \\
& formula & formula & Submodel formula \\
& link & function & Link function \\
& linkinv & function & Inverse link function \\
& name & character & Stock name \\
& range & numeric & Age and year range \\
& vcov & array & Variance-covariance matrix \\
\end{longtable}

\hypertarget{submodel-structure}{%
\chapter{\texorpdfstring{Submodel structure \label{sec:submod}}{Submodel structure }}\label{submodel-structure}}

Placeholder

\hypertarget{submodel-building-blocks-and-fundamental-r-formulas}{%
\section{\texorpdfstring{Submodel building blocks and fundamental \texttt{R} formulas}{Submodel building blocks and fundamental R formulas}}\label{submodel-building-blocks-and-fundamental-r-formulas}}

\hypertarget{the-major-effects-available-for-modelling}{%
\section{The major effects available for modelling}\label{the-major-effects-available-for-modelling}}

\hypertarget{the-submodel-class-and-methods}{%
\section{The submodel class and methods}\label{the-submodel-class-and-methods}}

\hypertarget{fitting}{%
\chapter{Fitting}\label{fitting}}

Placeholder

\hypertarget{fishing-mortality-submodel-f_ay}{%
\section{\texorpdfstring{Fishing mortality submodel (\(F_{ay}\))}{Fishing mortality submodel (F\_\{ay\})}}\label{fishing-mortality-submodel-f_ay}}

\hypertarget{separable-model}{%
\subsection{Separable model}\label{separable-model}}

\hypertarget{constant-selectivity-for-contiguous-ages-or-years}{%
\subsection{Constant selectivity for contiguous ages or years}\label{constant-selectivity-for-contiguous-ages-or-years}}

\hypertarget{time-blocks-selectivity}{%
\subsection{Time blocks selectivity}\label{time-blocks-selectivity}}

\hypertarget{time-changing-selectivity}{%
\subsection{Time changing selectivity}\label{time-changing-selectivity}}

\hypertarget{closed-form-selection-pattern}{%
\subsection{Closed form selection pattern}\label{closed-form-selection-pattern}}

\hypertarget{more-models-to-be-moved-to-its-own-section}{%
\subsection{More models {[}TO BE MOVED TO ITS OWN SECTION?{]}}\label{more-models-to-be-moved-to-its-own-section}}

\hypertarget{abundance-indices-catchability-submodel-q_ays}{%
\section{\texorpdfstring{Abundance indices catchability submodel (\(Q_{ays}\))}{Abundance indices catchability submodel (Q\_\{ays\})}}\label{abundance-indices-catchability-submodel-q_ays}}

\hypertarget{catchability-submodel-for-age-based-indices}{%
\subsection{Catchability submodel for age based indices}\label{catchability-submodel-for-age-based-indices}}

\hypertarget{catchability-submodel-for-age-aggregated-biomass-indices}{%
\subsection{Catchability submodel for age aggregated biomass indices}\label{catchability-submodel-for-age-aggregated-biomass-indices}}

\hypertarget{catchability-submodel-for-single-age-indices}{%
\subsection{Catchability submodel for single age indices}\label{catchability-submodel-for-single-age-indices}}

\hypertarget{stock-recruitment-submodel-r_y}{%
\section{\texorpdfstring{Stock-recruitment submodel (\(R_y\))}{Stock-recruitment submodel (R\_y)}}\label{stock-recruitment-submodel-r_y}}

\hypertarget{observation-variance-submodel-sigma2_ay-tau2_ays}{%
\section{\texorpdfstring{Observation variance submodel (\(\{\sigma^2_{ay}, \tau^2_{ays}\}\))}{Observation variance submodel (\textbackslash\{\textbackslash sigma\^{}2\_\{ay\}, \textbackslash tau\^{}2\_\{ays\}\textbackslash\})}}\label{observation-variance-submodel-sigma2_ay-tau2_ays}}

\hypertarget{initial-year-abundance-submodel-n_ay1}{%
\section{\texorpdfstring{Initial year abundance submodel (\(N_{a,y=1}\))}{Initial year abundance submodel (N\_\{a,y=1\})}}\label{initial-year-abundance-submodel-n_ay1}}

\hypertarget{data-weigthing}{%
\section{Data weigthing}\label{data-weigthing}}

\hypertarget{working-with-covariates}{%
\section{Working with covariates}\label{working-with-covariates}}

\hypertarget{assessing-files}{%
\section{\texorpdfstring{Assessing \ADMB files}{Assessing files}}\label{assessing-files}}

\hypertarget{missing-observations-in-the-catch-matrix-or-index}{%
\section{Missing observations in the catch matrix or index}\label{missing-observations-in-the-catch-matrix-or-index}}

\hypertarget{diagnostics}{%
\chapter{\texorpdfstring{Diagnostics \label{sec:diagn}}{Diagnostics }}\label{diagnostics}}

Placeholder

\hypertarget{residuals}{%
\section{Residuals}\label{residuals}}

\hypertarget{predictive-skill}{%
\section{Predictive skill}\label{predictive-skill}}

\hypertarget{aggreagted-catch-in-weight}{%
\section{Aggreagted catch in weight}\label{aggreagted-catch-in-weight}}

\hypertarget{fit-summary-information-and-cross-validation-metrics}{%
\section{Fit summary, information and cross-validation metrics}\label{fit-summary-information-and-cross-validation-metrics}}

\hypertarget{the-package-a4adiags}{%
\section{The package a4adiags}\label{the-package-a4adiags}}

\hypertarget{residuals-and-submodels-misspecifiction}{%
\section{Residuals and submodels misspecifiction}\label{residuals-and-submodels-misspecifiction}}

\hypertarget{the-mean-model}{%
\subsection{The ``mean'' model}\label{the-mean-model}}

\hypertarget{the-age-effects}{%
\subsection{The age effects}\label{the-age-effects}}

\hypertarget{the-fishing-mortality-year-model}{%
\subsection{The fishing mortality year model}\label{the-fishing-mortality-year-model}}

\hypertarget{the-initial-year-population-abundance-model-aka-n1}{%
\subsection{The initial year population abundance model, aka N1}\label{the-initial-year-population-abundance-model-aka-n1}}

\hypertarget{the-stock-recruitment-submodel}{%
\subsection{The stock recruitment submodel}\label{the-stock-recruitment-submodel}}

\hypertarget{the-variance-submodel}{%
\subsection{The variance submodel}\label{the-variance-submodel}}

\hypertarget{hindcast}{%
\chapter{Hindcast}\label{hindcast}}

alternative setups and metrics and what it means (EJ to share an initial structure)

\hypertarget{reference-points}{%
\chapter{Reference Points}\label{reference-points}}

Placeholder

\hypertarget{yield-per-recruit-reference-points}{%
\section{Yield per recruit reference points}\label{yield-per-recruit-reference-points}}

\hypertarget{stock-recruitment-relationship-based-reference-points}{%
\section{Stock recruitment relationship based reference points}\label{stock-recruitment-relationship-based-reference-points}}

\hypertarget{stock-recruitment-after-fitting-the-stock-assessment-model}{%
\subsection{Stock recruitment after fitting the stock assessment model}\label{stock-recruitment-after-fitting-the-stock-assessment-model}}

\hypertarget{stock-recruitment-during-fitting-the-stock-assessment-model}{%
\subsection{Stock recruitment during fitting the stock assessment model}\label{stock-recruitment-during-fitting-the-stock-assessment-model}}

\hypertarget{economics-reference-points}{%
\section{Economics reference points}\label{economics-reference-points}}

\hypertarget{computing-user-specific-reference-points}{%
\section{Computing user specific reference points}\label{computing-user-specific-reference-points}}

\hypertarget{projections-and-harvest-control-rules}{%
\chapter{Projections and harvest control rules}\label{projections-and-harvest-control-rules}}

Placeholder

\hypertarget{initial-condition-assumptions-check-fwdwindow}{%
\section{Initial condition assumptions {[}CHECK fwdWindow{]}}\label{initial-condition-assumptions-check-fwdwindow}}

\hypertarget{scenarios}{%
\section{Scenarios}\label{scenarios}}

\hypertarget{relative-scenarios}{%
\subsection{Relative scenarios}\label{relative-scenarios}}

\hypertarget{limits}{%
\subsection{Limits}\label{limits}}

\hypertarget{complex-scenario}{%
\subsection{Complex scenario}\label{complex-scenario}}

\hypertarget{predict-and-simulate}{%
\chapter{\texorpdfstring{Predict and simulate \label{sec:predsim}}{Predict and simulate }}\label{predict-and-simulate}}

Placeholder

\hypertarget{basic-functions}{%
\section{Basic functions\}}\label{basic-functions}}

\hypertarget{simulate}{%
\subsection{simulate()}\label{simulate}}

\hypertarget{genflquant}{%
\subsection{genFLQuant()}\label{genflquant}}

\hypertarget{submodels}{%
\section{submodels}\label{submodels}}

\hypertarget{predict}{%
\section{Predict}\label{predict}}

\hypertarget{simulate-1}{%
\section{Simulate}\label{simulate-1}}

\hypertarget{the-statistical-catch-at-age-stock-assessment-framework-with-mcmc}{%
\chapter{\texorpdfstring{The statistical catch-at-age stock assessment framework with MCMC \label{sec:mcmc}}{The statistical catch-at-age stock assessment framework with MCMC }}\label{the-statistical-catch-at-age-stock-assessment-framework-with-mcmc}}

Placeholder

\hypertarget{diagnostics-with-coda}{%
\section{Diagnostics with CODA}\label{diagnostics-with-coda}}

\hypertarget{propagate-uncertainty-into-stock-assessment}{%
\chapter{Propagate uncertainty into stock assessment}\label{propagate-uncertainty-into-stock-assessment}}

Placeholder

\hypertarget{modelling-fleet-selectivity}{%
\chapter{Modelling fleet selectivity}\label{modelling-fleet-selectivity}}

\hypertarget{modelling-spatial-effects}{%
\chapter{Modelling spatial effects}\label{modelling-spatial-effects}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ridx01 }\OtherTok{\textless{}{-}}\NormalTok{ stk0}\SpecialCharTok{@}\NormalTok{stock.n[}\DecValTok{1}\NormalTok{]}\SpecialCharTok{*}\FloatTok{0.7}\SpecialCharTok{*}\FloatTok{0.001}
\NormalTok{ridx01 }\OtherTok{\textless{}{-}} \FunctionTok{log}\NormalTok{(ridx01}\SpecialCharTok{*}\FunctionTok{rlnorm}\NormalTok{(ridx01))}
\NormalTok{ridx02 }\OtherTok{\textless{}{-}}\NormalTok{ stk0}\SpecialCharTok{@}\NormalTok{stock.n[}\DecValTok{1}\NormalTok{]}\SpecialCharTok{*}\FloatTok{0.3}\SpecialCharTok{*}\FloatTok{0.001}
\NormalTok{ridx02 }\OtherTok{\textless{}{-}} \FunctionTok{log}\NormalTok{(ridx02}\SpecialCharTok{*}\FunctionTok{rlnorm}\NormalTok{(ridx02))}

\NormalTok{srmod }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}} \FunctionTok{geomean}\NormalTok{(a}\SpecialCharTok{\textasciitilde{}}\NormalTok{ridx01}\SpecialCharTok{+}\NormalTok{ridx02, }\AttributeTok{CV=}\FloatTok{0.5}\NormalTok{)}
\NormalTok{cvar }\OtherTok{\textless{}{-}} \FunctionTok{FLQuants}\NormalTok{(}\AttributeTok{ridx01 =}\NormalTok{ ridx01, }\AttributeTok{ridx02 =}\NormalTok{ ridx02)}
\NormalTok{fit01 }\OtherTok{\textless{}{-}} \FunctionTok{sca}\NormalTok{(stock,tun.sel[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{)],}\AttributeTok{fmodel=}\NormalTok{fmod,}\AttributeTok{qmodel=}\NormalTok{qmod, }\AttributeTok{srmodel=}\NormalTok{srmod, }\AttributeTok{covar=}\NormalTok{cvar)}
\FunctionTok{coef}\NormalTok{(fit01)}
\NormalTok{srmod }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}} \FunctionTok{geomean}\NormalTok{(}\AttributeTok{CV=}\FloatTok{0.1}\NormalTok{)}
\NormalTok{fit02 }\OtherTok{\textless{}{-}} \FunctionTok{sca}\NormalTok{(stock,tun.sel[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{)],}\AttributeTok{fmodel=}\NormalTok{fmod,}\AttributeTok{qmodel=}\NormalTok{qmod, }\AttributeTok{srmodel=}\NormalTok{srmod)}
\FunctionTok{coef}\NormalTok{(fit02)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  check situation where the two areas are negatively correlated
\item
  the two covariates need to be at the same scale, in the sense of representing the same process
\item
  other examples (ICES, ask in the plenary if we can have access to the data)
\item
  dan ghotel ask for spatial workshop data
\end{itemize}

\hypertarget{sections-to-be-added}{%
\chapter{Sections to be added!?}\label{sections-to-be-added}}

\begin{itemize}
\tightlist
\item
  Assessing the coverage of confidence intervals??
\end{itemize}

\end{document}
