--- 
title: "Fish stock assessment with R"
subtitle: "The a4a Initiative"
author: "Ernesto Jardim, Colin Millar, Danai Mantopoulou Palouka and Iago Mosqueira"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]
url: your book url like https://ejardim.github.io/a4abook/
# cover-image: path to the social sharing image like images/cover.jpg
description: |
  How to do stock assessment in R using the a4a framework
link-citations: yes
github-repo: ejardim/a4abook
output:
    split_bib: false
    pdf_document:
        extra_dependencies: ["a4a"]
---

# Before starting

```{r, knitr_opts, echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
library(formatR)
#thm = knit_theme$get("bclear") #moe, bclear
#knit_theme$set(thm)
opts_chunk$set(dev='png', dev.args=list(type="cairo"), warning=FALSE)
# lattice theme
library(lattice)
lattice.options(default.args = list(as.table = TRUE))
```

## Installing and loading libraries

To run the methods in this book the reader will need to install the `FLa4a` package [@fla4a] and its dependencies. Some datasets are distributed with the package and as such need to be loaded too.

```{R, eval=FALSE}
# from CRAN
install.packages(c("copula","triangle", "coda", "grid", "gridExtra", "latticeExtra"))
# from FLR
install.packages(c("FLCore", "FLa4a"), repos="http://flr-project.org/R")
```

```{R, message=FALSE, warning=FALSE}
# libraries
library(devtools)
library(FLa4a)
library(XML)
library(reshape2)
library(ggplotFL)
# datasets
data(ple4)
data(ple4.indices)
data(ple4.index)
data(rfLen)
```

```{R}
packageVersion("FLCore")
packageVersion("FLa4a")
```

## How to read this document

The target audience for this document are readers with some experience in R and some background on stock assessment.

The document explains the approach being developed by the Assessment for All Initiative (a4a) for fish stock assessment and scientific advice. It presents a mixture of text and code, where the first explains the concepts behind the methods, while the last shows how these can be run with the software provided. Moreover, having the code allows the reader to copy/paste and replicate the analysis presented here.

The sections and subsections are as independent as possible, so they can be used as a reference document for the `FLa4a`.

## How to get help 

`FLa4a` is build using `R`'s object oriented implementation with S4 classes, and `FLCore`'s [@flr] class structures and methods. In order to access S4 methods and classes documentation the user needs to use specific terminology.

For example, `FLStock` is one of our main components in order to run our stock assessment model. We can check the structure of an `FLStock` object as follows:

```{r}
showClass("FLStock")
```

The object oriented structure of `FLa4a` gives the opportunity to change the behavior of a function according to the object that is applied to. For example we can check the available methods of the function `plot`

```{r}
showMethods("plot")
```

by calling `showMethods` R prints all the possible uses of the `plot` function. We want to see what it does when it is called on an `FLStock` object with no other object. We observe that `plot` takes two arguments, `x` and `y`. So, in the signature of the `getMethod` function we are going to use, we need to define both `x` and `y`.

```{r}
getMethod('plot', signature = list("FLStock","missing"))
```

More information can be found in `R`'s documentation (https://www.r-project.org/).

## Notation

Along this chapter the notation presented in Table \@ref(tab:mathsnotation) will be used. Mathematical descriptions will be kept as simple as possible for readability.

|Type|Symbol|Description| 
|:---|-----:|:----------|
|variables| | |
| |$C$ | catches|
| |$F$ | fishing mortality |
| |$M$ | natural mortality |
| |$R$ | recruitment |
| |$Q$ | vessel or fleet catchability |
| |$w$ | weights |
| |$l$ | likelihood |
| |$I$ | abundance index |
| |$S$ | spawning stock biomass |
| |$CV$ | coefficient of variation |
| |$D$ | residuals or deviances |
| |$N$ | population numbers |
| |$\beta, \gamma$ | parameters |
| |$a$ | stock-recruitment parameter |
| |$b$ | stock-recruitment parameter |
| |$\sigma^2$ | variance of catch |
| |$\tau^2$ | variance of index |
| |$\phi^2$ | variance of predicted recruitment |
| |$\upsilon^2$ | variance of residuals |
|subscripts | | |
| |$a$ | age |
| |$y$ | year |
| |$C$ | catch |
| |$I$ | abundance index |
| |$N$ | normal distribution |
| |$s$ | survey |
| |$SR$ | stock recruitment relationship |
|superscripts and accents | | |
| |$\hat{}$ | observation |
| |$\tilde{}$ | prediction |
| |$c$ | catches |
| |$s$ | abundance index |

Table: (\#tab:mathsnotation) Mathematical notation

```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```

## Acknowledgements

TBD

## License

This book is released under a Creative Commons license [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/).

The `FLa4a` package is released under the [EUPL 1.1](https://joinup.ec.europa.eu/community/eupl/home).



