<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Uncertainty  | Fish stock assessment with R - DRAFT</title>
  <meta name="description" content="How to do stock assessment in R using the a4a framework" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Uncertainty  | Fish stock assessment with R - DRAFT" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="How to do stock assessment in R using the a4a framework" />
  <meta name="github-repo" content="ejardim/a4abook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Uncertainty  | Fish stock assessment with R - DRAFT" />
  
  <meta name="twitter:description" content="How to do stock assessment in R using the a4a framework" />
  



<meta name="date" content="2025-06-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="diagnostics.html"/>
<link rel="next" href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Stock assessment framework</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Before starting</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#installing-and-loading-libraries"><i class="fa fa-check"></i><b>1.1</b> Installing and loading libraries</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#how-to-read-this-document"><i class="fa fa-check"></i><b>1.2</b> How to read this document</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#how-to-get-help"><i class="fa fa-check"></i><b>1.3</b> How to get help</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.4</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.5</b> License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#book-concept-and-target-audience"><i class="fa fa-check"></i><b>2.1</b> Book concept and target audience</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#the-assessment-for-all-initiative-a4a"><i class="fa fa-check"></i><b>2.2</b> The “Assessment for All” Initiative (a4a)</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#multi-stage-modelling-approach"><i class="fa fa-check"></i><b>2.3</b> Multi-stage modelling approach</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#stock-assessment-process"><i class="fa fa-check"></i><b>2.4</b> Stock Assessment Process</a></li>
<li class="chapter" data-level="2.5" data-path="introduction.html"><a href="introduction.html#data-used-in-the-book"><i class="fa fa-check"></i><b>2.5</b> Data used in the book</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="introduction.html"><a href="introduction.html#plaice-in-area-fao-27-ices-area-iv"><i class="fa fa-check"></i><b>2.5.1</b> Plaice in area FAO 27, ICES area IV</a></li>
<li class="chapter" data-level="2.5.2" data-path="introduction.html"><a href="introduction.html#european-hake-in-fao-37-gsas-1567"><i class="fa fa-check"></i><b>2.5.2</b> European hake in FAO 37, GSAs 1,5,6,7</a></li>
<li class="chapter" data-level="2.5.3" data-path="introduction.html"><a href="introduction.html#red-mullet-in-fao-37-gsa-9"><i class="fa fa-check"></i><b>2.5.3</b> Red mullet in FAO 37, GSA 9</a></li>
<li class="chapter" data-level="2.5.4" data-path="introduction.html"><a href="introduction.html#redfish-simulated-length-data"><i class="fa fa-check"></i><b>2.5.4</b> Redfish simulated length data</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="introduction.html"><a href="introduction.html#notation"><i class="fa fa-check"></i><b>2.6</b> Notation</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="growth.html"><a href="growth.html"><i class="fa fa-check"></i><b>3</b> Modelling Individual Growth and Using Stochastic Slicing to Convert Length-based Data Into Age-based Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="growth.html"><a href="growth.html#a4agr---the-growth-class"><i class="fa fa-check"></i><b>3.1</b> a4aGr - The growth class</a></li>
<li class="chapter" data-level="3.2" data-path="growth.html"><a href="growth.html#adding-uncertainty-to-growth-parameters-with-a-multivariate-normal-distribution"><i class="fa fa-check"></i><b>3.2</b> Adding uncertainty to growth parameters with a multivariate normal distribution</a></li>
<li class="chapter" data-level="3.3" data-path="growth.html"><a href="growth.html#adding-uncertainty-to-growth-parameters-with-a-multivariate-triangle-distribution"><i class="fa fa-check"></i><b>3.3</b> Adding uncertainty to growth parameters with a multivariate triangle distribution</a></li>
<li class="chapter" data-level="3.4" data-path="growth.html"><a href="growth.html#adding-uncertainty-to-growth-parameters-with-statistical-copulas"><i class="fa fa-check"></i><b>3.4</b> Adding uncertainty to growth parameters with statistical copulas</a></li>
<li class="chapter" data-level="3.5" data-path="growth.html"><a href="growth.html#converting-from-length-to-age-based-data---the-l2a-method"><i class="fa fa-check"></i><b>3.5</b> Converting from length to age based data - the <code>l2a()</code> method</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="modelling-natural-mortality.html"><a href="modelling-natural-mortality.html"><i class="fa fa-check"></i><b>4</b> Modelling Natural Mortality</a>
<ul>
<li class="chapter" data-level="4.1" data-path="modelling-natural-mortality.html"><a href="modelling-natural-mortality.html#a4am---the-m-class"><i class="fa fa-check"></i><b>4.1</b> <code>a4aM</code> - The M class</a></li>
<li class="chapter" data-level="4.2" data-path="modelling-natural-mortality.html"><a href="modelling-natural-mortality.html#adding-uncertainty-to-natural-mortality-parameters-with-a-multivariate-normal-distribution"><i class="fa fa-check"></i><b>4.2</b> Adding uncertainty to natural mortality parameters with a multivariate normal distribution</a></li>
<li class="chapter" data-level="4.3" data-path="modelling-natural-mortality.html"><a href="modelling-natural-mortality.html#adding-uncertainty-to-natural-mortality-parameters-with-statistical-copulas"><i class="fa fa-check"></i><b>4.3</b> Adding uncertainty to natural mortality parameters with statistical copulas</a></li>
<li class="chapter" data-level="4.4" data-path="modelling-natural-mortality.html"><a href="modelling-natural-mortality.html#computing-natural-mortality-time-series---the-m-method"><i class="fa fa-check"></i><b>4.4</b> Computing natural mortality time series - the <code>m()</code> method</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="stock-assessment-framework.html"><a href="stock-assessment-framework.html"><i class="fa fa-check"></i><b>5</b> Stock assessment framework</a>
<ul>
<li class="chapter" data-level="5.1" data-path="stock-assessment-framework.html"><a href="stock-assessment-framework.html#maths-description"><i class="fa fa-check"></i><b>5.1</b> Maths description </a></li>
<li class="chapter" data-level="5.2" data-path="stock-assessment-framework.html"><a href="stock-assessment-framework.html#model-structure"><i class="fa fa-check"></i><b>5.2</b> Model structure </a></li>
<li class="chapter" data-level="5.3" data-path="stock-assessment-framework.html"><a href="stock-assessment-framework.html#submodel-building-blocks-and-fundamental-r-formulas"><i class="fa fa-check"></i><b>5.3</b> Submodel building blocks and fundamental <code>R</code> formulas</a></li>
<li class="chapter" data-level="5.4" data-path="stock-assessment-framework.html"><a href="stock-assessment-framework.html#the-major-effects-available-for-modelling"><i class="fa fa-check"></i><b>5.4</b> The major effects available for modelling</a></li>
<li class="chapter" data-level="5.5" data-path="stock-assessment-framework.html"><a href="stock-assessment-framework.html#classes-description"><i class="fa fa-check"></i><b>5.5</b> Classes Description </a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="introduction-to-splines.html"><a href="introduction-to-splines.html"><i class="fa fa-check"></i><b>6</b> Introduction to Splines</a>
<ul>
<li class="chapter" data-level="6.1" data-path="introduction-to-splines.html"><a href="introduction-to-splines.html#generalize-to-polynomials"><i class="fa fa-check"></i><b>6.1</b> Generalize to polynomials</a></li>
<li class="chapter" data-level="6.2" data-path="introduction-to-splines.html"><a href="introduction-to-splines.html#thin-plate-spline"><i class="fa fa-check"></i><b>6.2</b> Thin plate spline</a></li>
<li class="chapter" data-level="6.3" data-path="introduction-to-splines.html"><a href="introduction-to-splines.html#the-mgcv-package-inside-a4a"><i class="fa fa-check"></i><b>6.3</b> The <code>mgcv</code> package inside <code>a4a</code></a></li>
<li class="chapter" data-level="6.4" data-path="introduction-to-splines.html"><a href="introduction-to-splines.html#on-the-number-of-knots-k"><i class="fa fa-check"></i><b>6.4</b> On the number of knots <span class="math inline">\(k\)</span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="fitting.html"><a href="fitting.html"><i class="fa fa-check"></i><b>7</b> Fitting</a>
<ul>
<li class="chapter" data-level="7.1" data-path="fitting.html"><a href="fitting.html#fishing-mortality-submodel-f_ay"><i class="fa fa-check"></i><b>7.1</b> Fishing mortality submodel (<span class="math inline">\(F_{ay}\)</span>)</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="fitting.html"><a href="fitting.html#separable-model"><i class="fa fa-check"></i><b>7.1.1</b> Separable model</a></li>
<li class="chapter" data-level="7.1.2" data-path="fitting.html"><a href="fitting.html#model-with-age-year-interaction"><i class="fa fa-check"></i><b>7.1.2</b> Model with age-year interaction</a></li>
<li class="chapter" data-level="7.1.3" data-path="fitting.html"><a href="fitting.html#constant-selectivity-for-contiguous-ages-or-years"><i class="fa fa-check"></i><b>7.1.3</b> Constant selectivity for contiguous ages or years</a></li>
<li class="chapter" data-level="7.1.4" data-path="fitting.html"><a href="fitting.html#time-blocks-selectivity"><i class="fa fa-check"></i><b>7.1.4</b> Time blocks selectivity</a></li>
<li class="chapter" data-level="7.1.5" data-path="fitting.html"><a href="fitting.html#time-changing-selectivity"><i class="fa fa-check"></i><b>7.1.5</b> Time changing selectivity</a></li>
<li class="chapter" data-level="7.1.6" data-path="fitting.html"><a href="fitting.html#closed-form-selection-pattern"><i class="fa fa-check"></i><b>7.1.6</b> Closed form selection pattern</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="fitting.html"><a href="fitting.html#abundance-indices-catchability-submodel-q_ays"><i class="fa fa-check"></i><b>7.2</b> Abundance indices catchability submodel (<span class="math inline">\(Q_{ays}\)</span>)</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="fitting.html"><a href="fitting.html#catchability-submodel-for-age-based-indices"><i class="fa fa-check"></i><b>7.2.1</b> Catchability submodel for age based indices</a></li>
<li class="chapter" data-level="7.2.2" data-path="fitting.html"><a href="fitting.html#catchability-submodel-for-age-aggregated-biomass-indices"><i class="fa fa-check"></i><b>7.2.2</b> Catchability submodel for age aggregated biomass indices</a></li>
<li class="chapter" data-level="7.2.3" data-path="fitting.html"><a href="fitting.html#catchability-submodel-for-single-age-indices"><i class="fa fa-check"></i><b>7.2.3</b> Catchability submodel for single age indices</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="fitting.html"><a href="fitting.html#stock-recruitment-submodel-r_y"><i class="fa fa-check"></i><b>7.3</b> Stock-recruitment submodel (<span class="math inline">\(R_y\)</span>)</a></li>
<li class="chapter" data-level="7.4" data-path="fitting.html"><a href="fitting.html#observation-variance-submodel-sigma2_ay-tau2_ays"><i class="fa fa-check"></i><b>7.4</b> Observation variance submodel (<span class="math inline">\(\{\sigma^2_{ay}, \tau^2_{ays}\}\)</span>)</a></li>
<li class="chapter" data-level="7.5" data-path="fitting.html"><a href="fitting.html#initial-year-abundance-submodel-n_ay1"><i class="fa fa-check"></i><b>7.5</b> Initial year abundance submodel (<span class="math inline">\(N_{a,y=1}\)</span>)</a></li>
<li class="chapter" data-level="7.6" data-path="fitting.html"><a href="fitting.html#more-models"><i class="fa fa-check"></i><b>7.6</b> More models</a></li>
<li class="chapter" data-level="7.7" data-path="fitting.html"><a href="fitting.html#data-weigthing"><i class="fa fa-check"></i><b>7.7</b> Data weigthing</a></li>
<li class="chapter" data-level="7.8" data-path="fitting.html"><a href="fitting.html#working-with-covariates"><i class="fa fa-check"></i><b>7.8</b> Working with covariates</a></li>
<li class="chapter" data-level="7.9" data-path="fitting.html"><a href="fitting.html#assessing-admb-files"><i class="fa fa-check"></i><b>7.9</b> Assessing <code>ADMB</code> files</a></li>
<li class="chapter" data-level="7.10" data-path="fitting.html"><a href="fitting.html#missing-observations-in-the-catch-matrix-or-index"><i class="fa fa-check"></i><b>7.10</b> Missing observations in the catch matrix or index</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="diagnostics.html"><a href="diagnostics.html"><i class="fa fa-check"></i><b>8</b> Diagnostics </a>
<ul>
<li class="chapter" data-level="8.1" data-path="diagnostics.html"><a href="diagnostics.html#residuals"><i class="fa fa-check"></i><b>8.1</b> Residuals</a></li>
<li class="chapter" data-level="8.2" data-path="diagnostics.html"><a href="diagnostics.html#predictive-skill"><i class="fa fa-check"></i><b>8.2</b> Predictive skill</a></li>
<li class="chapter" data-level="8.3" data-path="diagnostics.html"><a href="diagnostics.html#aggregated-catch-in-weight"><i class="fa fa-check"></i><b>8.3</b> Aggregated catch in weight</a></li>
<li class="chapter" data-level="8.4" data-path="diagnostics.html"><a href="diagnostics.html#fit-summary-information-and-cross-validation-metrics"><i class="fa fa-check"></i><b>8.4</b> Fit summary, information and cross-validation metrics</a></li>
<li class="chapter" data-level="8.5" data-path="diagnostics.html"><a href="diagnostics.html#retrospective-analysis"><i class="fa fa-check"></i><b>8.5</b> Retrospective analysis</a></li>
<li class="chapter" data-level="8.6" data-path="diagnostics.html"><a href="diagnostics.html#hindcast"><i class="fa fa-check"></i><b>8.6</b> Hindcast</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="uncertainty.html"><a href="uncertainty.html"><i class="fa fa-check"></i><b>9</b> Uncertainty </a>
<ul>
<li class="chapter" data-level="9.1" data-path="uncertainty.html"><a href="uncertainty.html#the-simulate-and-predict-methods"><i class="fa fa-check"></i><b>9.1</b> The <code>simulate</code> and <code>predict</code> methods</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="uncertainty.html"><a href="uncertainty.html#predict"><i class="fa fa-check"></i><b>9.1.1</b> <code>predict()</code></a></li>
<li class="chapter" data-level="9.1.2" data-path="uncertainty.html"><a href="uncertainty.html#simulate"><i class="fa fa-check"></i><b>9.1.2</b> <code>simulate()</code></a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="uncertainty.html"><a href="uncertainty.html#prediction-error"><i class="fa fa-check"></i><b>9.2</b> Prediction error</a></li>
<li class="chapter" data-level="9.3" data-path="uncertainty.html"><a href="uncertainty.html#confidence-interval-coverage"><i class="fa fa-check"></i><b>9.3</b> Confidence interval coverage</a></li>
<li class="chapter" data-level="9.4" data-path="uncertainty.html"><a href="uncertainty.html#propagate-uncertainty-into-stock-assessment"><i class="fa fa-check"></i><b>9.4</b> Propagate uncertainty into stock assessment</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><i class="fa fa-check"></i><b>10</b> The statistical catch-at-age stock assessment framework with Markov Chain Monte Carlo (MCMC) </a>
<ul>
<li class="chapter" data-level="10.1" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#the-mcmc-method-for-sca"><i class="fa fa-check"></i><b>10.1</b> The MCMC method for <code>sca</code></a></li>
<li class="chapter" data-level="10.2" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#diagnostics-with-coda"><i class="fa fa-check"></i><b>10.2</b> Diagnostics with CODA</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#traceplots"><i class="fa fa-check"></i><b>10.2.1</b> Traceplots</a></li>
<li class="chapter" data-level="10.2.2" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#autocorrelation-and-crosscorrelation-analysis"><i class="fa fa-check"></i><b>10.2.2</b> Autocorrelation and crosscorrelation analysis</a></li>
<li class="chapter" data-level="10.2.3" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#geweke-diagnostic"><i class="fa fa-check"></i><b>10.2.3</b> Geweke diagnostic</a></li>
<li class="chapter" data-level="10.2.4" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#cumulative-means"><i class="fa fa-check"></i><b>10.2.4</b> Cumulative means</a></li>
<li class="chapter" data-level="10.2.5" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#distribution-density"><i class="fa fa-check"></i><b>10.2.5</b> Distribution density</a></li>
<li class="chapter" data-level="10.2.6" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#gelman-rubin-statistic"><i class="fa fa-check"></i><b>10.2.6</b> Gelman-Rubin statistic</a></li>
<li class="chapter" data-level="10.2.7" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#acceptance-rate"><i class="fa fa-check"></i><b>10.2.7</b> Acceptance rate</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#admbs-arguments-to-tune-the-mcmc-algorithm"><i class="fa fa-check"></i><b>10.3</b> <code>ADMB</code>’s arguments to tune the MCMC algorithm</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#thinning-rate"><i class="fa fa-check"></i><b>10.3.1</b> Thinning rate</a></li>
<li class="chapter" data-level="10.3.2" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#mcscale-and-mcnoscale"><i class="fa fa-check"></i><b>10.3.2</b> mcscale and mcnoscale</a></li>
<li class="chapter" data-level="10.3.3" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#mcprobe"><i class="fa fa-check"></i><b>10.3.3</b> mcprobe</a></li>
<li class="chapter" data-level="10.3.4" data-path="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html"><a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html#mcrb"><i class="fa fa-check"></i><b>10.3.4</b> mcrb</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="reference-points.html"><a href="reference-points.html"><i class="fa fa-check"></i><b>11</b> Reference Points</a>
<ul>
<li class="chapter" data-level="11.1" data-path="reference-points.html"><a href="reference-points.html#yield-per-recruit-reference-points"><i class="fa fa-check"></i><b>11.1</b> Yield per recruit reference points</a></li>
<li class="chapter" data-level="11.2" data-path="reference-points.html"><a href="reference-points.html#stock-recruitment-relationship-based-reference-points"><i class="fa fa-check"></i><b>11.2</b> Stock recruitment relationship based reference points</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="reference-points.html"><a href="reference-points.html#stock-recruitment-after-fitting-the-stock-assessment-model"><i class="fa fa-check"></i><b>11.2.1</b> Stock recruitment after fitting the stock assessment model</a></li>
<li class="chapter" data-level="11.2.2" data-path="reference-points.html"><a href="reference-points.html#stock-recruitment-during-stock-assessment-model-fit"><i class="fa fa-check"></i><b>11.2.2</b> Stock recruitment during stock assessment model fit</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="reference-points.html"><a href="reference-points.html#economics-reference-points"><i class="fa fa-check"></i><b>11.3</b> Economics reference points</a></li>
<li class="chapter" data-level="11.4" data-path="reference-points.html"><a href="reference-points.html#computing-user-specific-reference-points"><i class="fa fa-check"></i><b>11.4</b> Computing user specific reference points</a></li>
<li class="chapter" data-level="11.5" data-path="reference-points.html"><a href="reference-points.html#assessing-the-status-of-the-stock"><i class="fa fa-check"></i><b>11.5</b> Assessing the status of the stock</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html"><i class="fa fa-check"></i><b>12</b> Projections and harvest control rules</a>
<ul>
<li class="chapter" data-level="12.1" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html#simple-workflow"><i class="fa fa-check"></i><b>12.1</b> Simple workflow</a></li>
<li class="chapter" data-level="12.2" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html#initial-condition-assumptions"><i class="fa fa-check"></i><b>12.2</b> Initial condition assumptions</a></li>
<li class="chapter" data-level="12.3" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html#scenarios"><i class="fa fa-check"></i><b>12.3</b> Scenarios</a></li>
<li class="chapter" data-level="12.4" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html#relative-scenarios"><i class="fa fa-check"></i><b>12.4</b> Relative scenarios</a></li>
<li class="chapter" data-level="12.5" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html#limits"><i class="fa fa-check"></i><b>12.5</b> Limits</a></li>
<li class="chapter" data-level="12.6" data-path="projections-and-harvest-control-rules.html"><a href="projections-and-harvest-control-rules.html#harvest-control-rules-hcr"><i class="fa fa-check"></i><b>12.6</b> Harvest Control Rules (HCR)</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html"><i class="fa fa-check"></i><b>13</b> Annex - stock assessment workflow</a>
<ul>
<li class="chapter" data-level="13.1" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html#the-mean-model"><i class="fa fa-check"></i><b>13.1</b> The “mean” model</a></li>
<li class="chapter" data-level="13.2" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html#the-age-effects"><i class="fa fa-check"></i><b>13.2</b> The age effects</a></li>
<li class="chapter" data-level="13.3" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html#year-effect-on-fishing-mortality"><i class="fa fa-check"></i><b>13.3</b> Year effect on fishing mortality</a></li>
<li class="chapter" data-level="13.4" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html#year-effect-on-catchability"><i class="fa fa-check"></i><b>13.4</b> Year effect on catchability</a></li>
<li class="chapter" data-level="13.5" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html#the-initial-year-population-abundance-model-aka-n1"><i class="fa fa-check"></i><b>13.5</b> The initial year population abundance model, aka N1</a></li>
<li class="chapter" data-level="13.6" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html#the-stock-recruitment-submodel"><i class="fa fa-check"></i><b>13.6</b> The stock recruitment submodel</a></li>
<li class="chapter" data-level="13.7" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html#the-variance-submodel"><i class="fa fa-check"></i><b>13.7</b> The variance submodel</a></li>
<li class="chapter" data-level="13.8" data-path="annex---stock-assessment-workflow.html"><a href="annex---stock-assessment-workflow.html#final-comments"><i class="fa fa-check"></i><b>13.8</b> Final comments</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>14</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Fish stock assessment with R - DRAFT</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="uncertainty" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">9</span> Uncertainty <a href="uncertainty.html#uncertainty" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Uncertainty is a fundamental aspect of scientific advice, serving as a reflection of the inherent limitations within the knowledge base used to construct evidence and support scientific opinions. It highlights the gaps, variability, and potential biases present in data, methods, and modeling assumptions that underlie scientific conclusions.</p>
<p>In fisheries science, a field that has evolved primarily to provide evidence-based advice for the sustainable exploitation of marine resources, acknowledging and addressing uncertainty is of major importance. Given the dynamic, complex, and partially observable nature of aquatic ecosystems, the need to systematically characterize and communicate uncertainty is paramount to ensuring robust and credible assessments <span class="citation">(<a href="#ref-privitera2019">Privitera-Johnson and Punt 2019</a>)</span>.</p>
<p>In this section we’ll address two important elements of quantifying uncertainty in stock assessment results, prediction error<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> and propagation of uncertainty across modelling stages.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="uncertainty.html#cb190-1" tabindex="-1"></a><span class="fu">library</span>(FLa4a)</span>
<span id="cb190-2"><a href="uncertainty.html#cb190-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb190-3"><a href="uncertainty.html#cb190-3" tabindex="-1"></a><span class="fu">data</span>(hke1567)</span>
<span id="cb190-4"><a href="uncertainty.html#cb190-4" tabindex="-1"></a><span class="fu">data</span>(hke1567.idx)</span></code></pre></div>
<p>The two workhorses for this topic are <code>predict()</code> and <code>simulate()</code> which are implemented to work with <code>sca</code> fits of type <code>"assessment"</code>. Note <code>fit = "MP"</code> doesn’t compute the variance-covariance matrix of the parameters, which is essential for simulating.</p>
<p>This chapter is based on the following model:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="uncertainty.html#cb191-1" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="dv">250</span></span>
<span id="cb191-2"><a href="uncertainty.html#cb191-2" tabindex="-1"></a>fmod <span class="ot">&lt;-</span> <span class="er">~</span><span class="fu">s</span>(age, <span class="at">k =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb191-3"><a href="uncertainty.html#cb191-3" tabindex="-1"></a>    <span class="fu">s</span>(year, <span class="at">k =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb191-4"><a href="uncertainty.html#cb191-4" tabindex="-1"></a>    <span class="fu">s</span>(year, <span class="at">k =</span> <span class="dv">8</span>, <span class="at">by =</span> <span class="fu">as.numeric</span>(age <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb191-5"><a href="uncertainty.html#cb191-5" tabindex="-1"></a>    <span class="fu">s</span>(year, <span class="at">k =</span> <span class="dv">8</span>, <span class="at">by =</span> <span class="fu">as.numeric</span>(age <span class="sc">==</span> <span class="dv">4</span>))</span>
<span id="cb191-6"><a href="uncertainty.html#cb191-6" tabindex="-1"></a>qmod <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="sc">~</span><span class="fu">I</span>(<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>age))))</span>
<span id="cb191-7"><a href="uncertainty.html#cb191-7" tabindex="-1"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">sca</span>(hke1567, hke1567.idx, <span class="at">fmodel=</span>fmod, <span class="at">qmodel=</span>qmod)</span>
<span id="cb191-8"><a href="uncertainty.html#cb191-8" tabindex="-1"></a>stk0 <span class="ot">&lt;-</span> hke1567 <span class="sc">+</span> fit0</span></code></pre></div>
<div id="the-simulate-and-predict-methods" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> The <code>simulate</code> and <code>predict</code> methods<a href="uncertainty.html#the-simulate-and-predict-methods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="predict" class="section level3 hasAnchor" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> <code>predict()</code><a href="uncertainty.html#predict" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The predict method computes the quantities of interest using the estimated coefficients and the design matrix of the model, defined via the formulas in the submodels. The method uses a fitted model object, created by a call to <code>sca</code>, and returns a list with one element for each submodel, where each element is a <code>FLQuants</code> object.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="uncertainty.html#cb192-1" tabindex="-1"></a>fit.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit0)</span>
<span id="cb192-2"><a href="uncertainty.html#cb192-2" tabindex="-1"></a><span class="fu">lapply</span>(fit.pred, names)</span></code></pre></div>
<pre><code>## $stkmodel
## [1] &quot;harvest&quot; &quot;rec&quot;     &quot;ny1&quot;    
## 
## $qmodel
## [1] &quot;IND&quot;
## 
## $vmodel
## [1] &quot;catch&quot; &quot;IND&quot;</code></pre>
<p>The <code>stkmodel</code> element reports <code>harvest</code>, <code>rec</code> and <code>ny1</code>. The <code>qmodel</code> reports one <code>FLQuant</code> for each index, and the <code>vmodel</code> element returns one <code>FLQuant</code> for catch (in fact <code>catch.n</code>) and one for each index. This allows easy access to the parameterised parts of the model, for example the initial population structure, <code>ny1</code>, can be accessed via <code>fit.pred$stkmodel$ny1</code>.</p>
<pre><code>## An object of class &quot;FLQuant&quot;
## , , unit = unique, season = all, area = unique
## 
##    year
## age 2007  
##   0 366994
##   1  33695
##   2   4107
##   3    803
##   4    306
##   5    187
## 
## units:  1000</code></pre>
<p>If the fitted object has iterations, as after using the <code>simulate</code> method, which will be discussed in the next section, predict will be applied to each iter, generating distributions of the above mentioned quantities (Figure <a href="uncertainty.html#fig:simny1">9.1</a>).</p>
<div class="figure"><span style="display:block;" id="fig:simny1"></span>
<img src="_main_files/figure-html/simny1-1.png" alt="Simulations from the model prediction of initial age structure" width="672" />
<p class="caption">
Figure 9.1: Simulations from the model prediction of initial age structure
</p>
</div>
</div>
<div id="simulate" class="section level3 hasAnchor" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> <code>simulate()</code><a href="uncertainty.html#simulate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As the name implies <code>simulate</code> is used to generate simulations of the fit. It operates over objects of class <code>a4aFitSA</code> using the method <code>mvrnorm()</code> provided by the R package MASS <span class="citation">(<a href="#ref-mass">Venables and Ripley 2002</a>)</span>. The method generates random draws from a multivariate normal distribution with mean given by the coefficients of the model, and variance matrix given by the estimated covariance matrix of the coefficients. The method approximates the joint distribution of the model parameters as a multivariate normal in the log space, which is inline with the assumption made by <code>ADMB</code> when fitting the model. This approach is called ‘parametric bootstrap’, and it’s a common method for generating uncertainty in the parameters of a model.</p>
<p><code>simulate()</code> operates at the submodel level, <em>e.g.</em> <code>simulate(fit0@pars@qmodel, nsim=250)</code>, when called over a <code>a4aFitSA</code> object the method simply runs <code>simulate()</code> over each of the submodels. In this case it returns an object of the same class with model parameters replaced by <code>nsim</code> simulated parameters and updated slots <code>stock.n</code>, <code>catch.n</code> and <code>harvest</code>. Figure <a href="uncertainty.html#fig:predsimhist">9.2</a> depicts the distribution of a parameter, the observation error of the first survey index.</p>
<div class="figure"><span style="display:block;" id="fig:predsimhist"></span>
<img src="_main_files/figure-html/predsimhist-1.png" alt="Histogram of 250 draws from the approximate distribution of the estimate of survey observation error." width="672" />
<p class="caption">
Figure 9.2: Histogram of 250 draws from the approximate distribution of the estimate of survey observation error.
</p>
</div>
<p>In some simulation studies one needs to make sure the random draws are the same, which in <code>R</code> is obtained by explicitly setting the random seed with the method <code>set.seed()</code>. The same is achieved in this case as the example below shows.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="uncertainty.html#cb195-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb195-2"><a href="uncertainty.html#cb195-2" tabindex="-1"></a>fit.sim1 <span class="ot">&lt;-</span> <span class="fu">simulate</span>(fit0, <span class="at">nsim =</span> <span class="dv">250</span>)</span>
<span id="cb195-3"><a href="uncertainty.html#cb195-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb195-4"><a href="uncertainty.html#cb195-4" tabindex="-1"></a>fit.sim2 <span class="ot">&lt;-</span> <span class="fu">simulate</span>(fit0, <span class="at">nsim =</span> <span class="dv">250</span>)</span>
<span id="cb195-5"><a href="uncertainty.html#cb195-5" tabindex="-1"></a><span class="fu">all.equal</span>(fit.sim1, fit.sim2)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>If the whole stock is of interest, for example, to inspect model predictions of <span class="math inline">\(SSB\)</span>, the user should use the <code>+</code> method with a fitted object including iterations. In such case the <code>stock.n</code>, <code>catch.n</code> and <code>harvest</code> slots of the stock object will be updated and the usual metrics can be computed and extracted, <em>e.g.</em> <code>ssb(stk.pred)</code>. Figure <a href="uncertainty.html#fig:sim2">9.3</a> depicts the stock summary plot after adding estimation uncertainty through <code>simulate</code>.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="uncertainty.html#cb197-1" tabindex="-1"></a>stk.pred <span class="ot">&lt;-</span> hke1567 <span class="sc">+</span> fit.sim</span>
<span id="cb197-2"><a href="uncertainty.html#cb197-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">FLStocks</span>(<span class="at">simulated=</span>stk.pred, <span class="at">fitted=</span>stk0))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:sim2"></span>
<img src="_main_files/figure-html/sim2-1.png" alt="Stock summary of the simulated and fitted data" width="672" />
<p class="caption">
Figure 9.3: Stock summary of the simulated and fitted data
</p>
</div>
</div>
</div>
<div id="prediction-error" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Prediction error<a href="uncertainty.html#prediction-error" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To address this topic we’ll borrow from state-space modelling to define prediction error as the combination of observation error and estimation error (REF). Although <code>sca()</code> is not a state-space model, some of the inherent concepts of statistical catch at age models are similar to state-space models. <code>sca()</code> estimates parameters to model underlying unobserved processes, <em>e.g.</em> recruitment, catchability or fishing mortality, based on indirect observations of those processes, number of fish caught by the fleet and changes in abundance at sea.</p>
<p>Another similar approach can be found in statistical learning model. <span class="citation">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009">2009</a>)</span> decomposes prediction error into irreducible error, square bias and variance. Where the first term refers to variance that cannot be avoided, in our case estimated by residual variance. The second term, bias is ignored as the true value isn’t known and the fits are assumed to be unbiased. The last term is the variance of the prediction due to the training dataset samples, which we’re approximating with parameter estimation variance.</p>
<!--EJ NOTE: I think this paper supports the same idea [@harville85], although the maths are a bit (too...) much for me.-->
<!--In econometrics @greene explains the need to sum random noise and estimation error to build prediction intervals.

@book{greene2018econometric,
  title={Econometric Analysis},
  author={Greene, William H.},
  year={2018},
  edition={8th},
  publisher={Pearson Education},
  isbn={9780134461366}
}-->
<p>However, <code>sca</code>’s residuals are estimates of observation error (measurement noise) and model error (misspecification, omitted variables), which means it will be an overestimate of observation error.</p>
<p>Nevertheless, in this section we’ll assume prediction error to be the sum of residual variance and estimation variance, and will describe how to compute both elements and bringing them together in a <code>FLStock</code> object.</p>
<p>We’ll make extensive use of <code>+</code> for this analysis. When operating between a <code>FLStock</code> object and a <code>a4aFit</code> object, the method replaces the slots estimated by the model with its estimates. If operating between a <code>FLStock</code> object and a <code>a4aFitResiduals</code> object, the method will use the values in the <code>FLStock</code> object and add lognormal multiplicative error. When computing prediction uncertainty both sources need to be added, which means the sequence matters. To perform the computations correctly, residual uncertainty needs to be added after estimation uncertainty, so it will add uncertainty to the updated estimates.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="uncertainty.html#cb198-1" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="dv">250</span></span>
<span id="cb198-2"><a href="uncertainty.html#cb198-2" tabindex="-1"></a>fmod <span class="ot">&lt;-</span> <span class="er">~</span><span class="fu">s</span>(age, <span class="at">k =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb198-3"><a href="uncertainty.html#cb198-3" tabindex="-1"></a>    <span class="fu">s</span>(year, <span class="at">k =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb198-4"><a href="uncertainty.html#cb198-4" tabindex="-1"></a>    <span class="fu">s</span>(year, <span class="at">k =</span> <span class="dv">8</span>, <span class="at">by =</span> <span class="fu">as.numeric</span>(age <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb198-5"><a href="uncertainty.html#cb198-5" tabindex="-1"></a>    <span class="fu">s</span>(year, <span class="at">k =</span> <span class="dv">8</span>, <span class="at">by =</span> <span class="fu">as.numeric</span>(age <span class="sc">==</span> <span class="dv">4</span>))</span>
<span id="cb198-6"><a href="uncertainty.html#cb198-6" tabindex="-1"></a>qmod <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="sc">~</span><span class="fu">I</span>(<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>age))))</span>
<span id="cb198-7"><a href="uncertainty.html#cb198-7" tabindex="-1"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">sca</span>(hke1567, hke1567.idx, <span class="at">fmodel=</span>fmod, <span class="at">qmodel=</span>qmod)</span>
<span id="cb198-8"><a href="uncertainty.html#cb198-8" tabindex="-1"></a>stk0 <span class="ot">&lt;-</span> hke1567 <span class="sc">+</span> fit0</span>
<span id="cb198-9"><a href="uncertainty.html#cb198-9" tabindex="-1"></a></span>
<span id="cb198-10"><a href="uncertainty.html#cb198-10" tabindex="-1"></a><span class="co"># compute deviances</span></span>
<span id="cb198-11"><a href="uncertainty.html#cb198-11" tabindex="-1"></a>res0 <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit0, hke1567, hke1567.idx, <span class="at">type=</span><span class="st">&quot;deviances&quot;</span>)</span>
<span id="cb198-12"><a href="uncertainty.html#cb198-12" tabindex="-1"></a><span class="co"># build object with estimation uncertainty</span></span>
<span id="cb198-13"><a href="uncertainty.html#cb198-13" tabindex="-1"></a>stk.eu <span class="ot">&lt;-</span> hke1567 <span class="sc">+</span> <span class="fu">simulate</span>(fit0, nsim)</span>
<span id="cb198-14"><a href="uncertainty.html#cb198-14" tabindex="-1"></a><span class="co"># build object with residual uncertainty</span></span>
<span id="cb198-15"><a href="uncertainty.html#cb198-15" tabindex="-1"></a>stk.ru <span class="ot">&lt;-</span> <span class="fu">propagate</span>(stk0, nsim) <span class="sc">+</span> res0</span>
<span id="cb198-16"><a href="uncertainty.html#cb198-16" tabindex="-1"></a><span class="co"># build object with prediction uncertainty</span></span>
<span id="cb198-17"><a href="uncertainty.html#cb198-17" tabindex="-1"></a>stk.pu <span class="ot">&lt;-</span> hke1567 <span class="sc">+</span> <span class="fu">simulate</span>(fit0, nsim) <span class="sc">+</span> res0</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:preduncert"></span>
<img src="_main_files/figure-html/preduncert-1.png" alt="Prediction (pu), residual (ru) and estimation (eu) uncertainty" width="672" />
<p class="caption">
Figure 9.4: Prediction (pu), residual (ru) and estimation (eu) uncertainty
</p>
</div>
</div>
<div id="confidence-interval-coverage" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> Confidence interval coverage<a href="uncertainty.html#confidence-interval-coverage" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="uncertainty.html#cb199-1" tabindex="-1"></a>cv <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb199-2"><a href="uncertainty.html#cb199-2" tabindex="-1"></a>sn <span class="ot">&lt;-</span> <span class="fu">genFLQuant</span>(fit0<span class="sc">@</span>stock.n, <span class="at">cv=</span>cv)</span>
<span id="cb199-3"><a href="uncertainty.html#cb199-3" tabindex="-1"></a>ff <span class="ot">&lt;-</span> <span class="fu">genFLQuant</span>(fit0<span class="sc">@</span>harvest, <span class="at">cv=</span>cv, <span class="at">niter=</span>nsim)</span>
<span id="cb199-4"><a href="uncertainty.html#cb199-4" tabindex="-1"></a>stk00 <span class="ot">&lt;-</span> <span class="fu">genFLStock</span>(stk0, <span class="at">R=</span>sn[<span class="dv">1</span>], <span class="at">F=</span>ff, <span class="at">ny1=</span>sn[,<span class="dv">1</span>])</span>
<span id="cb199-5"><a href="uncertainty.html#cb199-5" tabindex="-1"></a>idx00 <span class="ot">&lt;-</span> hke1567.idx</span>
<span id="cb199-6"><a href="uncertainty.html#cb199-6" tabindex="-1"></a><span class="fu">index</span>(idx00) <span class="ot">&lt;-</span>  <span class="fu">predict</span>(<span class="fu">simulate</span>(fit0, nsim))<span class="sc">$</span>qmodel[[<span class="dv">1</span>]]<span class="sc">*</span>sn[<span class="fu">ac</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>)]</span>
<span id="cb199-7"><a href="uncertainty.html#cb199-7" tabindex="-1"></a>fit00 <span class="ot">&lt;-</span> <span class="fu">sca</span>(stk00, idx00, <span class="at">fmodel=</span>fmod, <span class="at">qmodel=</span>qmod)</span>
<span id="cb199-8"><a href="uncertainty.html#cb199-8" tabindex="-1"></a>stk00 <span class="ot">&lt;-</span> stk00 <span class="sc">+</span> fit00</span>
<span id="cb199-9"><a href="uncertainty.html#cb199-9" tabindex="-1"></a></span>
<span id="cb199-10"><a href="uncertainty.html#cb199-10" tabindex="-1"></a><span class="co"># objects to store results</span></span>
<span id="cb199-11"><a href="uncertainty.html#cb199-11" tabindex="-1"></a>flq <span class="ot">&lt;-</span> <span class="fu">ssb</span>(stk00) <span class="co">#expand(ssb(stk0), unit=c(&quot;eu&quot;, &quot;ru&quot;, &quot;pu&quot;), iter=1:nsim)</span></span>
<span id="cb199-12"><a href="uncertainty.html#cb199-12" tabindex="-1"></a>flq[] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb199-13"><a href="uncertainty.html#cb199-13" tabindex="-1"></a>ssb.cicvg <span class="ot">&lt;-</span> <span class="fu">FLQuants</span>(<span class="st">&quot;eu&quot;</span><span class="ot">=</span>flq, <span class="st">&quot;ru&quot;</span><span class="ot">=</span>flq, <span class="st">&quot;pu&quot;</span><span class="ot">=</span>flq)</span>
<span id="cb199-14"><a href="uncertainty.html#cb199-14" tabindex="-1"></a>flq <span class="ot">&lt;-</span> <span class="fu">expand</span>(flq, <span class="at">age=</span><span class="fu">c</span>(<span class="st">&quot;l&quot;</span>, <span class="st">&quot;u&quot;</span>))</span>
<span id="cb199-15"><a href="uncertainty.html#cb199-15" tabindex="-1"></a>ssb.ci <span class="ot">&lt;-</span> <span class="fu">FLQuants</span>(<span class="st">&quot;eu&quot;</span><span class="ot">=</span>flq, <span class="st">&quot;ru&quot;</span><span class="ot">=</span>flq, <span class="st">&quot;pu&quot;</span><span class="ot">=</span>flq)</span>
<span id="cb199-16"><a href="uncertainty.html#cb199-16" tabindex="-1"></a></span>
<span id="cb199-17"><a href="uncertainty.html#cb199-17" tabindex="-1"></a><span class="co"># remove iters that failed</span></span>
<span id="cb199-18"><a href="uncertainty.html#cb199-18" tabindex="-1"></a>vv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">!</span><span class="fu">is.na</span>(fit00<span class="sc">@</span>stock.n[<span class="dv">1</span>,<span class="dv">1</span>]))</span>
<span id="cb199-19"><a href="uncertainty.html#cb199-19" tabindex="-1"></a></span>
<span id="cb199-20"><a href="uncertainty.html#cb199-20" tabindex="-1"></a><span class="co"># loop through iters, compute CI, check if OM value is within interval</span></span>
<span id="cb199-21"><a href="uncertainty.html#cb199-21" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span>nsim)[vv]){</span>
<span id="cb199-22"><a href="uncertainty.html#cb199-22" tabindex="-1"></a></span>
<span id="cb199-23"><a href="uncertainty.html#cb199-23" tabindex="-1"></a>  <span class="co"># residual uncertainty</span></span>
<span id="cb199-24"><a href="uncertainty.html#cb199-24" tabindex="-1"></a>  res00 <span class="ot">&lt;-</span> <span class="fu">residuals</span>(<span class="fu">iter</span>(fit00, i), <span class="fu">iter</span>(stk00, i), <span class="fu">iter</span>(idx00, i), <span class="at">type=</span><span class="st">&quot;deviances&quot;</span>)</span>
<span id="cb199-25"><a href="uncertainty.html#cb199-25" tabindex="-1"></a>  stk <span class="ot">&lt;-</span> <span class="fu">propagate</span>(<span class="fu">iter</span>(stk00, i), nsim) <span class="sc">+</span> res00</span>
<span id="cb199-26"><a href="uncertainty.html#cb199-26" tabindex="-1"></a>  qtl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">ssb</span>(stk), <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb199-27"><a href="uncertainty.html#cb199-27" tabindex="-1"></a>  ssb.cicvg[[<span class="st">&quot;eu&quot;</span>]][,,,,, i] <span class="ot">&lt;-</span> <span class="fu">ssb</span>(stk0)<span class="sc">&gt;=</span><span class="fu">iter</span>(qtl, <span class="dv">1</span>) <span class="sc">&amp;</span> <span class="fu">ssb</span>(stk0)<span class="sc">&lt;=</span><span class="fu">iter</span>(qtl, <span class="dv">2</span>)</span>
<span id="cb199-28"><a href="uncertainty.html#cb199-28" tabindex="-1"></a>  ssb.ci[[<span class="st">&quot;eu&quot;</span>]][<span class="st">&quot;l&quot;</span>,,,,, i] <span class="ot">&lt;-</span> <span class="fu">iter</span>(qtl,<span class="dv">1</span>)</span>
<span id="cb199-29"><a href="uncertainty.html#cb199-29" tabindex="-1"></a>  ssb.ci[[<span class="st">&quot;eu&quot;</span>]][<span class="st">&quot;u&quot;</span>,,,,, i] <span class="ot">&lt;-</span> <span class="fu">iter</span>(qtl,<span class="dv">2</span>)</span>
<span id="cb199-30"><a href="uncertainty.html#cb199-30" tabindex="-1"></a></span>
<span id="cb199-31"><a href="uncertainty.html#cb199-31" tabindex="-1"></a>  <span class="co"># estimation uncertainty</span></span>
<span id="cb199-32"><a href="uncertainty.html#cb199-32" tabindex="-1"></a>  stk <span class="ot">&lt;-</span> <span class="fu">iter</span>(stk00, i) <span class="sc">+</span> <span class="fu">simulate</span>(<span class="fu">iter</span>(fit00, i), <span class="dv">250</span>)</span>
<span id="cb199-33"><a href="uncertainty.html#cb199-33" tabindex="-1"></a>  qtl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">ssb</span>(stk), <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb199-34"><a href="uncertainty.html#cb199-34" tabindex="-1"></a>  ssb.cicvg[[<span class="st">&quot;ru&quot;</span>]][,,,,, i] <span class="ot">&lt;-</span> <span class="fu">ssb</span>(stk0)<span class="sc">&gt;=</span><span class="fu">iter</span>(qtl, <span class="dv">1</span>) <span class="sc">&amp;</span> <span class="fu">ssb</span>(stk0)<span class="sc">&lt;=</span><span class="fu">iter</span>(qtl, <span class="dv">2</span>)</span>
<span id="cb199-35"><a href="uncertainty.html#cb199-35" tabindex="-1"></a>  ssb.ci[[<span class="st">&quot;ru&quot;</span>]][<span class="st">&quot;l&quot;</span>,,,,, i] <span class="ot">&lt;-</span> <span class="fu">iter</span>(qtl,<span class="dv">1</span>)</span>
<span id="cb199-36"><a href="uncertainty.html#cb199-36" tabindex="-1"></a>  ssb.ci[[<span class="st">&quot;ru&quot;</span>]][<span class="st">&quot;u&quot;</span>,,,,, i] <span class="ot">&lt;-</span> <span class="fu">iter</span>(qtl,<span class="dv">2</span>)</span>
<span id="cb199-37"><a href="uncertainty.html#cb199-37" tabindex="-1"></a></span>
<span id="cb199-38"><a href="uncertainty.html#cb199-38" tabindex="-1"></a>  <span class="co"># prediction uncertainty</span></span>
<span id="cb199-39"><a href="uncertainty.html#cb199-39" tabindex="-1"></a>  stk <span class="ot">&lt;-</span> stk <span class="sc">+</span> res00</span>
<span id="cb199-40"><a href="uncertainty.html#cb199-40" tabindex="-1"></a>  qtl <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">ssb</span>(stk), <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb199-41"><a href="uncertainty.html#cb199-41" tabindex="-1"></a>  ssb.cicvg[[<span class="st">&quot;pu&quot;</span>]][,,,,, i] <span class="ot">&lt;-</span> <span class="fu">ssb</span>(stk0)<span class="sc">&gt;=</span><span class="fu">iter</span>(qtl, <span class="dv">1</span>) <span class="sc">&amp;</span> <span class="fu">ssb</span>(stk0)<span class="sc">&lt;=</span><span class="fu">iter</span>(qtl, <span class="dv">2</span>)</span>
<span id="cb199-42"><a href="uncertainty.html#cb199-42" tabindex="-1"></a>  ssb.ci[[<span class="st">&quot;pu&quot;</span>]][<span class="st">&quot;l&quot;</span>,,,,, i] <span class="ot">&lt;-</span> <span class="fu">iter</span>(qtl,<span class="dv">1</span>)</span>
<span id="cb199-43"><a href="uncertainty.html#cb199-43" tabindex="-1"></a>  ssb.ci[[<span class="st">&quot;pu&quot;</span>]][<span class="st">&quot;u&quot;</span>,,,,, i] <span class="ot">&lt;-</span> <span class="fu">iter</span>(qtl,<span class="dv">2</span>)</span>
<span id="cb199-44"><a href="uncertainty.html#cb199-44" tabindex="-1"></a></span>
<span id="cb199-45"><a href="uncertainty.html#cb199-45" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="propagate-uncertainty-into-stock-assessment" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> Propagate uncertainty into stock assessment<a href="uncertainty.html#propagate-uncertainty-into-stock-assessment" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In a multistage stock assessment process as described in this book, it’s important to be able to propagate uncertainty across the different stages. This section describes methods to propagate uncertainty across stages and compares their outcomes in terms of stock assessment outputs.</p>
<p>The idea is to add uncertainty as one moves from one stage to the next. If a stock has uncertainty on it’s growth parameters, or natural mortality, or any other quantity estimated or set during the input data preparation, the model fit uncertainty will be added to it by generating iterations in the input data which are then used to fit the stock assessment model. The suggested workflow is:</p>
<ol style="list-style-type: decimal">
<li>Add uncertainty in growth or M parameters.</li>
<li>Draw from the parameters distribution.</li>
<li>Compute metrics for stock assessment.
<ol style="list-style-type: decimal">
<li>If there’s uncertainty in growth parameters use slicing to created iterations of metrics by age, e.g. catch at age and index at age.</li>
<li>If there’s uncertainty in M parameters draw from the distribution and generate iterations of the M matrix.</li>
<li>If both draw from growth and M parameters, potentially having into account correlation between those parameters, and generate iterations of age based metrics and M.</li>
</ol></li>
<li>Fit the stock assessment model to each iteration</li>
<li>Simulate from each fit</li>
<li>Aggregate results in single <code>FLStock</code> object.</li>
</ol>
<p>In this section we give an example of how uncertainty in natural mortality, set up using the <code>m()</code> method and the class <code>a4aM</code>, is propagated through the stock assessment. We’ll use the stock of Red Mullet in the Mediterranean GSA 1 (see Introduction for details) and 3 methods to add estimation uncertainty (step 5 above):</p>
<ol style="list-style-type: decimal">
<li>Take one draw of the fit</li>
<li>Take n draws of the fit and summarize with the median</li>
<li>Take n draws of the fit and combine all</li>
</ol>
<p>These outcomes will be compared with a fit across M iterations without any sampling from the fit.</p>
<p>Using <code>a4a</code> methods we’ll model natural mortality using a negative exponential model by age, Jensen’s estimator for the level and no time trend. We include multivariate normal uncertainty using the <code>mvrnorm()</code> method and create 250 iterations.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="uncertainty.html#cb200-1" tabindex="-1"></a>nits <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb200-2"><a href="uncertainty.html#cb200-2" tabindex="-1"></a></span>
<span id="cb200-3"><a href="uncertainty.html#cb200-3" tabindex="-1"></a>shape <span class="ot">&lt;-</span> <span class="fu">FLModelSim</span>(<span class="at">model=</span><span class="sc">~</span><span class="fu">exp</span>(<span class="sc">-</span>age<span class="fl">-0.5</span>))</span>
<span id="cb200-4"><a href="uncertainty.html#cb200-4" tabindex="-1"></a>level <span class="ot">&lt;-</span> <span class="fu">FLModelSim</span>(<span class="at">model=</span><span class="sc">~</span>k<span class="sc">^</span><span class="fl">0.66</span><span class="sc">*</span>t<span class="sc">^</span><span class="fl">0.57</span>, <span class="at">params =</span> <span class="fu">FLPar</span>(<span class="at">k=</span><span class="fl">0.4</span>, <span class="at">t=</span><span class="dv">10</span>),</span>
<span id="cb200-5"><a href="uncertainty.html#cb200-5" tabindex="-1"></a>                     <span class="at">vcov=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>,<span class="fl">0.01</span>, <span class="dv">1</span>), <span class="at">ncol=</span><span class="dv">2</span>))</span>
<span id="cb200-6"><a href="uncertainty.html#cb200-6" tabindex="-1"></a><span class="co">#trend &lt;- FLModelSim(model=~b, params=FLPar(b=0.5), vcov=matrix(0.02))</span></span>
<span id="cb200-7"><a href="uncertainty.html#cb200-7" tabindex="-1"></a></span>
<span id="cb200-8"><a href="uncertainty.html#cb200-8" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">a4aM</span>(<span class="at">shape=</span>shape, <span class="at">level=</span>level)</span>
<span id="cb200-9"><a href="uncertainty.html#cb200-9" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(nits, m4)</span>
<span id="cb200-10"><a href="uncertainty.html#cb200-10" tabindex="-1"></a><span class="fu">range</span>(m4)[] <span class="ot">&lt;-</span> <span class="fu">range</span>(stk00)[]</span>
<span id="cb200-11"><a href="uncertainty.html#cb200-11" tabindex="-1"></a><span class="fu">range</span>(m4)[<span class="fu">c</span>(<span class="st">&quot;minmbar&quot;</span>,<span class="st">&quot;maxmbar&quot;</span>)]<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb200-12"><a href="uncertainty.html#cb200-12" tabindex="-1"></a>flq <span class="ot">&lt;-</span> <span class="fu">m</span>(m4)[]</span>
<span id="cb200-13"><a href="uncertainty.html#cb200-13" tabindex="-1"></a><span class="fu">quant</span>(flq) <span class="ot">&lt;-</span> <span class="st">&quot;age&quot;</span></span>
<span id="cb200-14"><a href="uncertainty.html#cb200-14" tabindex="-1"></a>stk0 <span class="ot">&lt;-</span> <span class="fu">propagate</span>(stk00, nits)</span>
<span id="cb200-15"><a href="uncertainty.html#cb200-15" tabindex="-1"></a><span class="fu">m</span>(stk0) <span class="ot">&lt;-</span> flq</span></code></pre></div>
<p>The M matrix for this stock is shown in Figure<a href="uncertainty.html#fig:m">9.5</a>).</p>
<div class="figure"><span style="display:block;" id="fig:m"></span>
<img src="_main_files/figure-html/m-1.png" alt="Natural mortality generated from M model's parameter uncertainty" width="672" />
<p class="caption">
Figure 9.5: Natural mortality generated from M model’s parameter uncertainty
</p>
</div>
<p>We fit the same model to the new stock object which has uncertainty in the natural mortality and add estimation uncertainty following the methods described above.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="uncertainty.html#cb201-1" tabindex="-1"></a><span class="co"># create objects to store the results</span></span>
<span id="cb201-2"><a href="uncertainty.html#cb201-2" tabindex="-1"></a>stk01 <span class="ot">&lt;-</span> stk0</span>
<span id="cb201-3"><a href="uncertainty.html#cb201-3" tabindex="-1"></a>stk02 <span class="ot">&lt;-</span> stk0</span>
<span id="cb201-4"><a href="uncertainty.html#cb201-4" tabindex="-1"></a>stk03 <span class="ot">&lt;-</span> <span class="fu">propagate</span>(stk00, nits<span class="sc">*</span>nits)</span>
<span id="cb201-5"><a href="uncertainty.html#cb201-5" tabindex="-1"></a></span>
<span id="cb201-6"><a href="uncertainty.html#cb201-6" tabindex="-1"></a><span class="co"># run without estimation uncertainty</span></span>
<span id="cb201-7"><a href="uncertainty.html#cb201-7" tabindex="-1"></a>stk04 <span class="ot">&lt;-</span> stk00 <span class="sc">+</span> <span class="fu">sca</span>(stk0, idx00)</span>
<span id="cb201-8"><a href="uncertainty.html#cb201-8" tabindex="-1"></a><span class="co"># update M, the &quot;+&quot; method doesn&#39;t do it automatically</span></span>
<span id="cb201-9"><a href="uncertainty.html#cb201-9" tabindex="-1"></a><span class="fu">m</span>(stk04) <span class="ot">&lt;-</span> flq</span>
<span id="cb201-10"><a href="uncertainty.html#cb201-10" tabindex="-1"></a></span>
<span id="cb201-11"><a href="uncertainty.html#cb201-11" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nits){</span>
<span id="cb201-12"><a href="uncertainty.html#cb201-12" tabindex="-1"></a>    stk <span class="ot">&lt;-</span> <span class="fu">iter</span>(stk0, i)</span>
<span id="cb201-13"><a href="uncertainty.html#cb201-13" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">sca</span>(stk, idx00)</span>
<span id="cb201-14"><a href="uncertainty.html#cb201-14" tabindex="-1"></a>    <span class="co"># Method 1</span></span>
<span id="cb201-15"><a href="uncertainty.html#cb201-15" tabindex="-1"></a>    <span class="fu">iter</span>(stk01, i) <span class="ot">&lt;-</span> stk <span class="sc">+</span> <span class="fu">simulate</span>(fit, <span class="dv">1</span>)</span>
<span id="cb201-16"><a href="uncertainty.html#cb201-16" tabindex="-1"></a>    <span class="co"># Method 2</span></span>
<span id="cb201-17"><a href="uncertainty.html#cb201-17" tabindex="-1"></a>    <span class="fu">iter</span>(stk02, i) <span class="ot">&lt;-</span> <span class="fu">qapply</span>(stk <span class="sc">+</span> <span class="fu">simulate</span>(fit, nits), iterMedians)</span>
<span id="cb201-18"><a href="uncertainty.html#cb201-18" tabindex="-1"></a>    <span class="co"># Method 3</span></span>
<span id="cb201-19"><a href="uncertainty.html#cb201-19" tabindex="-1"></a>    <span class="fu">iter</span>(stk03, (nits<span class="sc">*</span>(i<span class="dv">-1</span>)<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(nits<span class="sc">*</span>i)) <span class="ot">&lt;-</span> stk <span class="sc">+</span> <span class="fu">simulate</span>(fit, nits)</span>
<span id="cb201-20"><a href="uncertainty.html#cb201-20" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:mprop"></span>
<img src="_main_files/figure-html/mprop-1.png" alt="Stock summary. Stock metrics computed over fits including uncertainty in M and estimation uncertainty" width="672" />
<p class="caption">
Figure 9.6: Stock summary. Stock metrics computed over fits including uncertainty in M and estimation uncertainty
</p>
</div>
<p>Method 1 and method 3 are the best propagating uncertainty and both give similar results. Method 1 will be faster since only one sample per fit is drawn, while method 3 will better describe the distribution but will be more computationally intensive.</p>

</div>
</div>
<h3> References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-hastie2009" class="csl-entry">
Hastie, Trevor, Robert Tibshirani, and Jerome Friedman. 2009. <em>The Elements of Statistical Learning: Data Mining, Inference, and Prediction</em>. 2nd ed. Springer Science &amp; Business Media.
</div>
<div id="ref-privitera2019" class="csl-entry">
Privitera-Johnson, Kristin M, and André E Punt. 2019. <span>“Leveraging Scientific Uncertainty in Fisheries Management for Estimating Among-Assessment Variation in Overfishing Limits.”</span> <em>ICES Journal of Marine Science</em> 77 (2): 515–26. <a href="https://doi.org/10.1093/icesjms/fsz237">https://doi.org/10.1093/icesjms/fsz237</a>.
</div>
<div id="ref-mass" class="csl-entry">
Venables, W. N., and B. D. Ripley. 2002. <em>Modern Applied Statistics with s</em>. Fourth. New York: Springer. <a href="https://www.stats.ox.ac.uk/pub/MASS4/">https://www.stats.ox.ac.uk/pub/MASS4/</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Work in progress<a href="uncertainty.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="diagnostics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-statistical-catch-at-age-stock-assessment-framework-with-markov-chain-monte-carlo-mcmc.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/USERNAME/REPO/edit/BRANCH/09-uncertainty.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf", "_main.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
